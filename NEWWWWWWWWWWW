-- ========================================
-- SERVICIOS Y REFERENCIAS GLOBALES
-- ========================================
local Players = game:GetService("Players")
local VirtualUser = game:GetService("VirtualUser")
local RS = game:GetService("ReplicatedStorage")
local VIM = game:GetService("VirtualInputManager")
local RunService = game:GetService("RunService")
local Stats = game:GetService("Stats")
local Workspace = workspace
local LP = Players.LocalPlayer
local Player = LP

-- ========================================
-- CONFIGURACIÓN DE DATOS
-- ========================================
local CONFIG = {
    BlacklistedUsers = {"DulceSkyx", "HonnyyDezz", "Honnydezz_z", "itsBAJAMILIONcat", "HonnyDezz_11", "PR_inmortal", "F3RNO0O00000", "xXLXGHTBRINGERXx"},
    BlacklistedPrefixes = {"SC_", "KTA_", "HZ_", "VAL_", "ZTX_"},
    
    Rocks = {
        {name = "Ancient Jungle Rock", display = "Jungle Rock (10M)", delay = 0.0001, pos = Vector3.new(-8976, 9, -6130), index = "10M"},
        {name = "Muscle King Mountain", display = "King Rock (5M)", delay = 0.0001, pos = Vector3.new(-8976, 9, -6130), index = "5M"},
        {name = "Rock Of Legends", display = "Legends Rock (1M)", delay = 0.01, pos = Vector3.new(4111.1640625, 991.6776123046875, -4043.022216796875), index = "1M"},
        {name = "Inferno Rock", display = "Inferno Rock (750K)", delay = 0.01, pos = Vector3.new(-7293.18, 8.42, -1232.74), index = "750K"},
        {name = "Frozen Rock", display = "Frozen Rock (150K)", delay = 0.01, pos = Vector3.new(-2528.79, 7.32, -207.19), index = "150K"},
        {name = "Punching Rock", display = "Golden Rock (5K)", delay = 0.01},
        {name = "Tiny Rock", display = "Tiny Rock (0)", delay = 0.01}
    },
    
    WorkoutPositions = {
        ["Bench Press"] = {
            ["Eternal Gym"] = CFrame.new(-7176.19, 45.39, -1106.31),
            ["Legend Gym"] = CFrame.new(4111.91, 1020.46, -3799.97),
            ["Muscle King Gym"] = CFrame.new(-8590.06, 46.01, -6043.34)
        },
        ["Squat"] = {
            ["Eternal Gym"] = CFrame.new(-7176.19, 45.39, -1106.31),
            ["Legend Gym"] = CFrame.new(4304.99, 987.82, -4124.23),
            ["Muscle King Gym"] = CFrame.new(-8940.12, 13.16, -5699.13)
        },
        ["Deadlift"] = {
            ["Eternal Gym"] = CFrame.new(-7176.19, 45.39, -1106.31),
            ["Legend Gym"] = CFrame.new(4304.99, 987.82, -4124.23),
            ["Muscle King Gym"] = CFrame.new(-8940.12, 13.16, -5699.13)
        },
        ["Pull Up"] = {
            ["Eternal Gym"] = CFrame.new(-7176.19, 45.39, -1106.31),
            ["Legend Gym"] = CFrame.new(4304.99, 987.82, -4124.23),
            ["Muscle King Gym"] = CFrame.new(-8940.12, 13.16, -5699.13)
        }
    },
    
    Tools = {
        {name = "Punch", attr = "attackTime", default = 0.35},
        {name = "Ground Slam", attr = "attackTime", default = 6},
        {name = "Stomp", attr = "attackTime", default = 7},
        {name = "Handstands", attr = "repTime", default = 1},
        {name = "Pushups", attr = "repTime", default = 1},
        {name = "Weight", attr = "repTime", default = 1},
        {name = "Situps", attr = "repTime", default = 1}
    },
    
    Pets = {
        Basic = {"Blue Birdie", "Orange Hedgehog", "Red Kitty", "Blue Bunny", "Silver Dog"},
        Advanced = {"Dark Vampy", "Dark Golem", "Green Butterfly", "Yellow Butterfly"},
        Rare = {"Crimson Falcon", "Purple Dragon", "Orange Pegasus", "Purple Falcon", "Red Dragon", "White Pegasus", "Frostwave Legends Penguin", "Phantom Genesis Dragon", "Eternal Strike Leviathan"},
        Epic = {"Blue Pheonix", "Blue Firecaster", "Golden Pheonix", "Red Firecaster", "Green Firecaster", "White Pheonix", "Dark Legends Manticore", "Ultimate Supernova Pegasus", "Lightning Strike Phantom", "Golden Viking"},
        Unique = {"Infernal Dragon", "Ultra Birdie", "Magic Butterfly", "Aether Spirit Bunny", "Cybernetic Showdown Dragon", "Darkstar Hunter", "Muscle Sensei", "Neon Guardian"}
    },
    
    Auras = {
        Basic = {"Blue Aura", "Green Aura", "Purple Aura", "Red Aura", "Yellow Aura"},
        Rare = {"Ultra Inferno"},
        Epic = {"Azure Tundra", "Grand Supernova"},
        Unique = {"Muscle King", "Entropic Blast", "Eternal Megastrike"}
    },
    
    Ultimates = {"+1 Daily Spin", "+1 Pet Slot", "+10 Item Capacity", "+5% Rep Speed", "Demon Damage", "Galaxy Gains", "Golden Rebirth", "Jungle Swift", "Muscle Mind", "x2 Chest Rewards", "x2 Quest Rewards"}
}

-- ========================================
-- VARIABLES DE ESTADO GLOBALES
-- ========================================
getgenv().godModeBrawl = false
getgenv().autoWinBrawl = false
getgenv().autoJoinBrawl = false
getgenv().workingGym = false
getgenv()._AutoRepFarmEnabled = false
getgenv()._AutoRepFarmLoop = false

local muscleEvent = Player:WaitForChild("muscleEvent")
local leaderstats = Player:WaitForChild("leaderstats")
local rebirthsStat = leaderstats:WaitForChild("Rebirths")
local strengthStat = leaderstats:WaitForChild("Strength")
local durabilityStat = Player:WaitForChild("Durability")

-- ========================================
-- FUNCIONES AUXILIARES
-- ========================================
local function isBlacklisted(plr)
    local u, d = plr.Name:lower(), (plr.DisplayName or ""):lower()
    for _, user in ipairs(CONFIG.BlacklistedUsers) do
        if u == user:lower() then return true end
    end
    for _, prefix in ipairs(CONFIG.BlacklistedPrefixes) do
        local p = prefix:lower()
        if u:sub(1, #p) == p or d:sub(1, #p) == p then return true end
    end
    return false
end

local function formatNumber(n)
    if n >= 1e15 then return string.format("%.2fQ", n/1e15) end
    if n >= 1e12 then return string.format("%.2fT", n/1e12) end
    if n >= 1e9 then return string.format("%.2fB", n/1e9) end
    if n >= 1e6 then return string.format("%.2fM", n/1e6) end
    if n >= 1e3 then return string.format("%.2fK", n/1e3) end
    return string.format("%.0f", n)
end

local function getChar() return LP.Character end

local function equipPunch()
    if not getgenv().autoWinBrawl then return end
    local char = getChar()
    if not char or char:FindFirstChild("Punch") then return end
    for _, tool in pairs(LP.Backpack:GetChildren()) do
        if tool:IsA("Tool") and tool.Name == "Punch" then
            tool.Parent = char
            break
        end
    end
end

local function isReady()
    local char = getChar()
    local hum = char and char:FindFirstChild("Humanoid")
    return hum and hum.Health > 0 and (char:FindFirstChild("LeftHand") or char:FindFirstChild("RightHand"))
end

local function validTarget(plr)
    if plr == LP or not plr.Character then return false end
    local hum = plr.Character:FindFirstChild("Humanoid")
    return hum and hum.Health > 0 and plr.Character:FindFirstChild("HumanoidRootPart")
end

local function touch(part1, part2)
    pcall(function()
        firetouchinterest(part1, part2, 0)
        task.wait()
        firetouchinterest(part1, part2, 1)
    end)
end

local function pressE()
    VIM:SendKeyEvent(true, "E", false, game)
    task.wait(0.1)
    VIM:SendKeyEvent(false, "E", false, game)
end

-- ========================================
-- VERIFICACIÓN DE USUARIO
-- ========================================
if isBlacklisted(Player) then
    warn("[Spectra X] Blacklisted user detected")
    task.spawn(function()
        for i = 1, 10 do
            RS.rEvents.rebirthRemote:InvokeServer("rebirthRequest")
            task.wait(0.1)
        end
        Player:Kick("Spectra X | Access denied")
    end)
    return
end

-- ========================================
-- ANTI-AFK
-- ========================================
Player.Idled:Connect(function()
    VirtualUser:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
    task.wait(1)
    VirtualUser:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
end)

-- ========================================
-- INTERFAZ GRÁFICA
-- ========================================
local displayName = Player.DisplayName ~= "" and Player.DisplayName or Player.Name
library = loadstring(game:HttpGet("https://raw.githubusercontent.com/CoronaBlanca/Lxbrxrys/refs/heads/main/Xlxrxxm"))()
local window = library:AddWindow(("Spectra X | Welcome %s"):format(displayName), {
    main_color = Color3.fromRGB(38, 32, 46),
    min_size = Vector2.new(590, 800),
    can_resize = true,
})

-- ========================================
-- TAB HOME
-- ========================================
local HomeTab = window:AddTab("Home")
HomeTab:AddLabel("╭──────────────────────────╮")
HomeTab:AddLabel("    Welcome To Spextra X")
HomeTab:AddLabel("╰──────────────────────────╯")
HomeTab:AddLabel("")
HomeTab:AddLabel("Script Made By")
HomeTab:AddLabel("")
HomeTab:AddLabel("Sherya (Isabella)")
HomeTab:AddLabel("")
HomeTab:AddLabel("Instagram : sheryaluck")
HomeTab:AddLabel("Tik tok : xvisherys")
HomeTab:AddLabel("Discord : isabella_hrz")
HomeTab:AddLabel("Roblox : MissSherya")
HomeTab:AddLabel("")
HomeTab:AddLabel("Thanks for using the script")
HomeTab:AddLabel("Errors to discord server")
HomeTab:AddLabel("")
HomeTab:AddButton("Servidor Discord", function()
    setclipboard("https://discord.gg/zYrg2qPjTp")
end)

-- ========================================
-- TAB MAIN - BRAWLS
-- ========================================
local MainTab = window:AddTab("Main")
local BrawlFolder = MainTab:AddFolder("  Auto Brawls")

BrawlFolder:AddSwitch("God Mode Brawl", function(state)
    getgenv().godModeBrawl = state
    if not state then return end
    task.spawn(function()
        while getgenv().godModeBrawl do
            RS.rEvents.brawlEvent:FireServer("joinBrawl")
            task.wait()
        end
    end)
end)

BrawlFolder:AddSwitch("Auto Win Brawls", function(state)
    getgenv().autoWinBrawl = state
    if not state then return end
    
    task.spawn(function()
        while getgenv().autoWinBrawl do
            if LP.PlayerGui.gameGui.brawlJoinLabel.Visible then
                RS.rEvents.brawlEvent:FireServer("joinBrawl")
                LP.PlayerGui.gameGui.brawlJoinLabel.Visible = false
            end
            task.wait(0.5)
        end
    end)
    
    task.spawn(function()
        while getgenv().autoWinBrawl do
            equipPunch()
            task.wait(0.5)
        end
    end)
    
    task.spawn(function()
        while getgenv().autoWinBrawl do
            if isReady() and RS.brawlInProgress.Value then
                pcall(function()
                    LP.muscleEvent:FireServer("punch", "leftHand")
                    LP.muscleEvent:FireServer("punch", "rightHand")
                end)
            end
            task.wait(0.1)
        end
    end)
    
    task.spawn(function()
        while getgenv().autoWinBrawl do
            if isReady() and RS.brawlInProgress.Value then
                local char = getChar()
                local lh, rh = char.LeftHand, char.RightHand
                for _, plr in pairs(Players:GetPlayers()) do
                    if validTarget(plr) then
                        local root = plr.Character.HumanoidRootPart
                        if lh then touch(root, lh) end
                        if rh then touch(root, rh) end
                    end
                end
            end
            task.wait(0.05)
        end
    end)
end)

BrawlFolder:AddSwitch("Auto Join Brawls", function(state)
    getgenv().autoJoinBrawl = state
    if not state then return end
    task.spawn(function()
        while getgenv().autoJoinBrawl do
            pcall(function()
                if LP.PlayerGui.gameGui.brawlJoinLabel.Visible then
                    RS.rEvents.brawlEvent:FireServer("joinBrawl")
                    LP.PlayerGui.gameGui.brawlJoinLabel.Visible = false
                end
            end)
            task.wait(0.5)
        end
    end)
end)

-- ========================================
-- TAB MAIN - GYMS
-- ========================================
local farmGymsFolder = MainTab:AddFolder("  Auto Gyms")
local gymToggles = {}
local workoutTypes = {"Bench Press", "Squat", "Deadlift", "Pull Up"}
local gymLocations = {"Eternal Gym", "Legend Gym", "Muscle King Gym"}

local function autoLift()
    while getgenv().workingGym do
        LP.muscleEvent:FireServer("rep")
        task.wait()
    end
end

local function teleportAndStart(cf)
    local char = LP.Character
    if not (char and char:FindFirstChild("HumanoidRootPart")) then return end
    char.HumanoidRootPart.CFrame = cf
    task.wait(0.15)
    pressE()
    task.spawn(autoLift)
end

for _, workoutType in ipairs(workoutTypes) do
    local cleanName = workoutType:gsub(" ", "")
    _G["selected" .. cleanName .. "Gym"] = gymLocations[1]
    
    local dropdown = farmGymsFolder:AddDropdown(workoutType .. " - Gym", function(v)
        _G["selected" .. cleanName .. "Gym"] = v
    end)
    
    for _, gym in ipairs(gymLocations) do
        dropdown:Add(gym)
    end
    
    local toggle = farmGymsFolder:AddSwitch(workoutType, function(state)
        getgenv().workingGym = state
        if not state then return end
        
        for k, t in pairs(gymToggles) do
            if k ~= workoutType then t:Set(false) end
        end
        
        local cf = CONFIG.WorkoutPositions[workoutType][_G["selected" .. cleanName .. "Gym"]]
        if cf then teleportAndStart(cf) end
    end)
    
    gymToggles[workoutType] = toggle
end

-- ========================================
-- TAB MAIN - ROCKS
-- ========================================
local rockFolder = MainTab:AddFolder("  Auto Rocks")

local function AddAutoPunchRock(title, rockName, delay)
    local enabled = false
    rockFolder:AddSwitch(title, function(state)
        enabled = state
        if enabled then
            task.spawn(function()
                while enabled do
                    local rock = tonumber(rockName) and Workspace.machinesFolder:GetChildren()[tonumber(rockName)] or Workspace.machinesFolder:FindFirstChild(rockName)
                    if rock and Player.Character and Player.Character:FindFirstChild("LeftHand") then
                        firetouchinterest(rock.Rock, Player.Character.LeftHand, 0)
                        task.wait(delay)
                        firetouchinterest(rock.Rock, Player.Character.LeftHand, 1)
                    end
                    RunService.Heartbeat:Wait()
                end
            end)
        end
    end)
end

for _, rock in ipairs(CONFIG.Rocks) do
    if rock.display then
        AddAutoPunchRock("Auto Punch " .. rock.display, rock.name == "Frozen Rock" and 6 or rock.name, rock.delay)
    end
end

rockFolder:AddSwitch("Auto Punch", function(state)
    _G.autopunch = state
    if state then
        local connection
        connection = RunService.Heartbeat:Connect(function()
            if not _G.autopunch then
                connection:Disconnect()
                return
            end
            local char = Player.Character
            local hum = char and char:FindFirstChildOfClass("Humanoid")
            if hum then
                local punchTool = Player.Backpack:FindFirstChild("Punch")
                if punchTool then hum:EquipTool(punchTool) end
                Player.muscleEvent:FireServer("punch", "rightHand")
                Player.muscleEvent:FireServer("punch", "leftHand")
            end
        end)
    end
end)

-- ========================================
-- TAB MAIN - AUTO EQUIP TOOLS
-- ========================================
local autoEquipToolsFolder = MainTab:AddFolder("  Auto Equip Tools")

autoEquipToolsFolder:AddButton("Gamepass AutoLift", function()
    local gamepassFolder = RS.gamepassIds
    for _, gamepass in pairs(gamepassFolder:GetChildren()) do
        local value = Instance.new("IntValue")
        value.Name = gamepass.Name
        value.Value = gamepass.Value
        value.Parent = Player.ownedGamepasses
    end
end, "AutoLift Free")

local toolsToAutomate = {"Weight", "Pushups", "Handstands", "Situps"}
for _, toolName in ipairs(toolsToAutomate) do
    autoEquipToolsFolder:AddSwitch("Auto " .. toolName, function(Value)
        _G["Auto" .. toolName] = Value
        
        if Value then
            local tool = Player.Backpack:FindFirstChild(toolName)
            if tool then Player.Character.Humanoid:EquipTool(tool) end
        else
            local equipped = Player.Character:FindFirstChild(toolName)
            if equipped then equipped.Parent = Player.Backpack end
        end
        
        task.spawn(function()
            while _G["Auto" .. toolName] do
                if not _G["Auto" .. toolName] then break end
                Player.muscleEvent:FireServer("rep")
                task.wait(0.1)
            end
        end)
    end)
end

autoEquipToolsFolder:AddSwitch("Fast Tools", function(Value)
    _G.FastTools = Value
    for _, toolInfo in ipairs(CONFIG.Tools) do
        local tool = Player.Backpack:FindFirstChild(toolInfo.name)
        if tool and tool:FindFirstChild(toolInfo.attr) then
            tool[toolInfo.attr].Value = Value and 0 or toolInfo.default
        end
        local equippedTool = Player.Character and Player.Character:FindFirstChild(toolInfo.name)
        if equippedTool and equippedTool:FindFirstChild(toolInfo.attr) then
            equippedTool[toolInfo.attr].Value = Value and 0 or toolInfo.default
        end
    end
end)

-- ========================================
-- TAB FARM
-- ========================================
local FarmTab = window:AddTab("Farm")
local RockFolder = FarmTab:AddFolder("  Auto Rock V2")
local RockToggles = {}

local function StartRockFarm(toggleName, position)
    task.spawn(function()
        while RockToggles[toggleName] do
            local char = Player.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                char.HumanoidRootPart.CFrame = CFrame.new(position)
            end
            task.wait(0.05)
        end
    end)
end

for _, rock in ipairs(CONFIG.Rocks) do
    if rock.index and rock.pos then
        RockFolder:AddSwitch("Auto Rock (" .. rock.index .. ")", function(state)
            RockToggles[rock.index] = state
            if state then StartRockFarm(rock.index, rock.pos) end
        end)
    end
end

-- ========================================
-- TAB FARM - TOOLS COMBINATION
-- ========================================
local toolsCombFolder = FarmTab:AddFolder("  Auto Tools OP")
toolsCombFolder:AddLabel("-----{ Weight + Punch }-----")

local function AddAutoTool(title, toolName, rockName, delay)
    local enabled = false
    local function Equip()
        local bp = Player:FindFirstChild("Backpack")
        local tool = bp and bp:FindFirstChild(toolName)
        if tool and not Player.Character:FindFirstChild(toolName) then
            Player.Character.Humanoid:EquipTool(tool)
        end
    end
    
    local function Unequip()
        local char = Player.Character
        local tool = char and char:FindFirstChild(toolName)
        if tool then tool.Parent = Player.Backpack end
    end
    
    local sw = toolsCombFolder:AddSwitch(title, function(state)
        enabled = state
        if enabled then
            Equip()
            _G.autopunch = true
            task.spawn(function()
                while enabled do
                    Player.muscleEvent:FireServer("rep")
                    local rock = workspace.machinesFolder:FindFirstChild(rockName)
                    if rock and Player.Character and Player.Character:FindFirstChild("LeftHand") then
                        firetouchinterest(rock.Rock, Player.Character.LeftHand, 0)
                        task.wait(delay)
                        firetouchinterest(rock.Rock, Player.Character.LeftHand, 1)
                    end
                    local char = Player.Character
                    local hum = char and char:FindFirstChildOfClass("Humanoid")
                    if hum then
                        local punchTool = Player.Backpack:FindFirstChild("Punch")
                        if punchTool then hum:EquipTool(punchTool) end
                        Player.muscleEvent:FireServer("punch", "rightHand")
                        Player.muscleEvent:FireServer("punch", "leftHand")
                    end
                    RunService.RenderStepped:Wait()
                    Equip()
                end
            end)
        else
            _G.autopunch = false
            Unequip()
        end
    end)
    
    Player.CharacterAdded:Connect(function()
        if enabled then Equip() else Unequip() end
    end)
    
    sw:Set(false)
end

local toolCombinations = {
    {"Auto Pushup + Auto Punch Rock", "Pushups"},
    {"Auto Situp + Auto Punch Rock", "Situps"},
    {"Auto Handstands + Auto Punch Rock", "Handstands"},
    {"Auto Weight + Auto Punch Rock", "Weight"}
}

for _, combo in ipairs(toolCombinations) do
    AddAutoTool(combo[1], combo[2], "Ancient Jungle Rock", 0.0001)
end

-- ========================================
-- TAB FARM - REBIRTHS
-- ========================================
local rebirthsFolder = FarmTab:AddFolder("  Auto Rebirths")
local targetRebirthValue = 0

rebirthsFolder:AddTextBox("Rebirth Target", function(text)
    local newValue = tonumber(text)
    if newValue and newValue > 0 then
        targetRebirthValue = newValue
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Objetivo Actualizado",
            Text = "Nuevo objetivo: " .. tostring(targetRebirthValue) .. " renacimientos",
            Duration = 0
        })
    end
end)

local infiniteSwitch
local targetSwitch = rebirthsFolder:AddSwitch("Auto Rebirth Target", function(bool)
    _G.targetRebirthActive = bool
    if bool then
        if _G.infiniteRebirthActive and infiniteSwitch then
            infiniteSwitch:Set(false)
            _G.infiniteRebirthActive = false
        end
        spawn(function()
            while _G.targetRebirthActive and wait(0.1) do
                if Player.leaderstats.Rebirths.Value >= targetRebirthValue then
                    targetSwitch:Set(false)
                    _G.targetRebirthActive = false
                    game:GetService("StarterGui"):SetCore("SendNotification", {
                        Title = "¡Objetivo Alcanzado!",
                        Text = "Has alcanzado " .. tostring(targetRebirthValue) .. " renacimientos",
                        Duration = 5
                    })
                    break
                end
                RS.rEvents.rebirthRemote:InvokeServer("rebirthRequest")
            end
        end)
    end
end)

infiniteSwitch = rebirthsFolder:AddSwitch("Auto Rebirth (Infinite)", function(bool)
    _G.infiniteRebirthActive = bool
    if bool then
        if _G.targetRebirthActive and targetSwitch then
            targetSwitch:Set(false)
            _G.targetRebirthActive = false
        end
        spawn(function()
            while _G.infiniteRebirthActive and wait(0.1) do
                RS.rEvents.rebirthRemote:InvokeServer("rebirthRequest")
            end
        end)
    end
end)

rebirthsFolder:AddSwitch("Auto Size 1", function(bool)
    _G.autoSizeActive = bool
    if bool then
        spawn(function()
            while _G.autoSizeActive and wait() do
                RS.rEvents.changeSpeedSizeRemote:InvokeServer("changeSize", 1)
            end
        end)
    end
end)

rebirthsFolder:AddSwitch("Auto Teleport King", function(state)
    _G.SafeZone = state
    if state then
        while _G.SafeZone do
            local char = Player.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                char.HumanoidRootPart.CFrame = CFrame.new(Vector3.new(-8636, 17, -5759))
            end
            task.wait(0.001)
        end
    end
end)

rebirthsFolder:AddButton("Anti Rebirth", function()
    local oldNamecall
    oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
        local args = {...}
        if self.Name == "rebirthRemote" and args[1] == "rebirthRequest" then
            return
        end
        return oldNamecall(self, unpack(args))
    end)
end)

-- ========================================
-- TAB PACKS - REBIRTH WITH PACKS
-- ========================================
local PacksTab = window:AddTab("Packs")
local RebirthFolder = PacksTab:AddFolder("  Rebirth With Packs")

local isRunning = false
local startTime, totalElapsed = 0, 0
local initialRebirths = rebirthsStat.Value
local lastRebirthTime = tick()
local lastRebirthValue = rebirthsStat.Value
local paceHistoryHour, paceHistoryDay, paceHistoryWeek = {}, {}, {}
local rebirthCount = 0

local serverLabel = RebirthFolder:AddLabel("Time:")
serverLabel.TextSize = 20
local timeLabel = RebirthFolder:AddLabel("0d 0h 0m 0s - Inactive")
local paceLabel = RebirthFolder:AddLabel("Pace: 0 / Hour | 0 / Day | 0 / Week")
local averagePaceLabel = RebirthFolder:AddLabel("Average Pace: 0 / Hour | 0 / Day | 0 / Week")

for _, lbl in pairs({timeLabel, paceLabel, averagePaceLabel}) do
    lbl.TextSize = 17
end
timeLabel.TextColor3 = Color3.fromRGB(255, 50, 50)

local rebirthsStatsLabel = RebirthFolder:AddLabel("Rebirths: "..formatNumber(rebirthsStat.Value).." | Gained: 0")
rebirthsStatsLabel.TextSize = 17

local function updateRebirthsLabel()
    local gained = rebirthsStat.Value - initialRebirths
    rebirthsStatsLabel.Text = string.format("Rebirths: %s | Gained: %s", formatNumber(rebirthsStat.Value), formatNumber(gained))
end

local function updateUI()
    local elapsed = isRunning and (tick() - startTime + totalElapsed) or totalElapsed
    local days = math.floor(elapsed / 86400)
    local hours = math.floor((elapsed % 86400) / 3600)
    local minutes = math.floor((elapsed % 3600) / 60)
    local seconds = math.floor(elapsed % 60)
    
    timeLabel.Text = string.format("%dd %dh %dm %ds - %s", days, hours, minutes, seconds, isRunning and "Rebirthing" or "Paused")
    timeLabel.TextColor3 = isRunning and Color3.fromRGB(50, 255, 50) or Color3.fromRGB(255, 50, 50)
end

local function calculatePaceOnRebirth()
    rebirthCount = rebirthCount + 1
    if rebirthCount < 2 then
        lastRebirthTime = tick()
        lastRebirthValue = rebirthsStat.Value
        return
    end
    
    local now = tick()
    local gained = rebirthsStat.Value - lastRebirthValue
    
    if gained > 0 then
        local avgTimePerRebirth = (now - lastRebirthTime) / gained
        local paceHour = 3600 / avgTimePerRebirth
        local paceDay = 86400 / avgTimePerRebirth
        local paceWeek = 604800 / avgTimePerRebirth
        
        paceLabel.Text = string.format("Pace: %s / Hour | %s / Day | %s / Week", formatNumber(paceHour), formatNumber(paceDay), formatNumber(paceWeek))
        
        table.insert(paceHistoryHour, paceHour)
        table.insert(paceHistoryDay, paceDay)
        table.insert(paceHistoryWeek, paceWeek)
        
        if #paceHistoryHour > 20 then
            table.remove(paceHistoryHour, 1)
            table.remove(paceHistoryDay, 1)
            table.remove(paceHistoryWeek, 1)
        end
        
        local function average(tbl)
            local sum = 0
            for _, v in ipairs(tbl) do sum = sum + v end
            return #tbl > 0 and (sum / #tbl) or 0
        end
        
        averagePaceLabel.Text = string.format("Average Pace: %s / Hour | %s / Day | %s / Week",
            formatNumber(average(paceHistoryHour)), formatNumber(average(paceHistoryDay)), formatNumber(average(paceHistoryWeek)))
        
        lastRebirthTime = now
        lastRebirthValue = rebirthsStat.Value
    end
end

rebirthsStat:GetPropertyChangedSignal("Value"):Connect(function()
    calculatePaceOnRebirth()
    updateRebirthsLabel()
end)

local function managePets(petName)
    for _, folder in pairs(Player.petsFolder:GetChildren()) do
        if folder:IsA("Folder") then
            for _, pet in pairs(folder:GetChildren()) do
                RS.rEvents.equipPetEvent:FireServer("unequipPet", pet)
            end
        end
    end
    task.wait(0.1)
    for _, pet in pairs(Player.petsFolder.Unique:GetChildren()) do
        if pet.Name == petName then
            RS.rEvents.equipPetEvent:FireServer("equipPet", pet)
        end
    end
end

local function doRebirth()
    local strengthTarget = 5000 + (rebirthsStat.Value * 2550)
    while isRunning and Player.leaderstats.Strength.Value < strengthTarget do
        local reps = Player.MembershipType == Enum.MembershipType.Premium and 8 or 14
        for _ = 1, reps do
            muscleEvent:FireServer("rep")
        end
        task.wait(0.02)
    end
    
    if isRunning and Player.leaderstats.Strength.Value >= strengthTarget then
        managePets("Tribal Overlord")
        task.wait(0.25)
        local before = rebirthsStat.Value
        repeat
            RS.rEvents.rebirthRemote:InvokeServer("rebirthRequest")
            task.wait(0.05)
        until rebirthsStat.Value > before or not isRunning
    end
end

local function fastRebirthLoop()
    while isRunning do
        managePets("Swift Samurai")
        doRebirth()
        task.wait(0.5)
    end
end

RebirthFolder:AddLabel("")
RebirthFolder:AddLabel("Rebirthing:").TextSize = 20

RebirthFolder:AddSwitch("Fast Rebirth", function(state)
    isRunning = state
    if state then
        startTime = tick()
        task.spawn(fastRebirthLoop)
    else
        totalElapsed = totalElapsed + (tick() - startTime)
        updateUI()
    end
end)

task.spawn(function()
    while true do
        updateUI()
        task.wait(0.1)
    end
end)

local running = false
RebirthFolder:AddSwitch("Set Size 1", function(bool)
    running = bool
    if running then
        task.spawn(function()
            while running do
                RS.rEvents.changeSpeedSizeRemote:InvokeServer("changeSize", 1)
                wait(0.01)
            end
        end)
    end
end)

RebirthFolder:AddButton("Anti Lag", function()
    for _, gui in pairs(Player.PlayerGui:GetChildren()) do
        if gui:IsA("ScreenGui") then gui:Destroy() end
    end
    
    local lighting = game:GetService("Lighting")
    for _, v in pairs(lighting:GetChildren()) do
        if v:IsA("Sky") then v:Destroy() end
    end
    
    local darkSky = Instance.new("Sky")
    darkSky.Name = "DarkSky"
    for _, prop in pairs({"SkyboxBk", "SkyboxDn", "SkyboxFt", "SkyboxLf", "SkyboxRt", "SkyboxUp"}) do
        darkSky[prop] = "rbxassetid://0"
    end
    darkSky.Parent = lighting
    
    lighting.Brightness = 0
    lighting.ClockTime = 0
    lighting.TimeOfDay = "00:00:00"
    lighting.OutdoorAmbient = Color3.new(0, 0, 0)
    lighting.Ambient = Color3.new(0, 0, 0)
    lighting.FogColor = Color3.new(0, 0, 0)
    lighting.FogEnd = 100
    
    task.spawn(function()
        while true do
            wait(5)
            if not lighting:FindFirstChild("DarkSky") then
                darkSky:Clone().Parent = lighting
            end
            lighting.Brightness = 0
            lighting.ClockTime = 0
        end
    end)
    
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("ParticleEmitter") or obj:IsA("PointLight") or obj:IsA("SpotLight") or obj:IsA("SurfaceLight") then
            obj:Destroy()
        end
    end
end)

RebirthFolder:AddLabel("")
RebirthFolder:AddLabel("Misc:").TextSize = 20

local lockRunning = false
RebirthFolder:AddSwitch("Lock Position", function(state)
    lockRunning = state
    if lockRunning then
        local char = Player.Character or Player.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")
        local lockPosition = hrp.Position
        task.spawn(function()
            while lockRunning do
                hrp.Velocity = Vector3.new(0, 0, 0)
                hrp.RotVelocity = Vector3.new(0, 0, 0)
                hrp.CFrame = CFrame.new(lockPosition)
                wait(0.05)
            end
        end)
    end
end)

local shakeRunning = false
task.spawn(function()
    while true do
        if shakeRunning then
            local tool = Player.Character:FindFirstChild("Tropical Shake") or Player.Backpack:FindFirstChild("Tropical Shake")
            if tool then muscleEvent:FireServer("tropicalShake", tool) end
            task.wait(450)
        else
            task.wait(1)
        end
    end
end)

RebirthFolder:AddSwitch("Auto Shake", function(state)
    shakeRunning = state
end)

RebirthFolder:AddSwitch("Spin Fortune Wheel", function(bool)
    _G.AutoSpinWheel = bool
    if bool then
        spawn(function()
            while _G.AutoSpinWheel and wait(1) do
                RS.rEvents.openFortuneWheelRemote:InvokeServer("openFortuneWheel", RS.fortuneWheelChances["Fortune Wheel"])
            end
        end)
    end
end)

RebirthFolder:AddSwitch("Hide All Frames", function(bool)
    for _, obj in pairs(RS:GetChildren()) do
        if obj.Name:match("Frame$") then
            obj.Visible = not bool
        end
    end
end)

RebirthFolder:AddButton("Jungle Lift", function()
    local char = Player.Character or Player.CharacterAdded:wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    hrp.CFrame = CFrame.new(-8642.396484375, 6.7980651855, 2086.1030273)
    task.wait(0.2)
    VIM:SendKeyEvent(true, Enum.KeyCode.E, false, game)
    task.wait(0.05)
    VIM:SendKeyEvent(false, Enum.KeyCode.E, false, game)
end)

-- ========================================
-- TAB PACKS - STRENGTH WITH PACKS
-- ========================================
local StrengthFolder = PacksTab:AddFolder("  Strength With Packs")

StrengthFolder:AddLabel("Time:").TextSize = 20
local stopwatchLabel = StrengthFolder:AddLabel("0d 0h 0m 0s - Fast Rep Inactive")
stopwatchLabel.TextSize = 17
stopwatchLabel.TextColor3 = Color3.fromRGB(255, 50, 50)

local projectedStrengthLabel = StrengthFolder:AddLabel("Strength Pace: 0 /Hour | 0 /Day | 0 /Week")
local projectedDurabilityLabel = StrengthFolder:AddLabel("Durability Pace: 0 /Hour | 0 /Day | 0 /Week")
local averageStrengthLabel = StrengthFolder:AddLabel("Average Strength Pace: 0 /Hour | 0 /Day | 0 /Week")
local averageDurabilityLabel = StrengthFolder:AddLabel("Average Durability Pace: 0 /Hour | 0 /Day | 0 /Week")

for _, lbl in pairs({projectedStrengthLabel, projectedDurabilityLabel, averageStrengthLabel, averageDurabilityLabel}) do
    lbl.TextSize = 17
end

StrengthFolder:AddLabel("")
StrengthFolder:AddLabel("Stats:").TextSize = 20

local strengthLabel = StrengthFolder:AddLabel("Strength: 0 | Gained: 0")
local durabilityLabel = StrengthFolder:AddLabel("Durability: 0 | Gained: 0")
strengthLabel.TextSize = 17
durabilityLabel.TextSize = 17

local startTime, pausedElapsedTime, trackingStarted, runFastRep = 0, 0, false, false
local strengthHistory, durabilityHistory = {}, {}
local calculationInterval = 10
local initialStrength = strengthStat.Value
local initialDurability = durabilityStat.Value

task.spawn(function()
    local lastCalcTime = tick()
    while true do
        local now = tick()
        local curStr = strengthStat.Value
        local curDur = durabilityStat.Value
        
        strengthLabel.Text = "Strength: " .. formatNumber(curStr) .. " | Gained: " .. formatNumber(curStr - initialStrength)
        durabilityLabel.Text = "Durability: " .. formatNumber(curDur) .. " | Gained: " .. formatNumber(curDur - initialDurability)
        
        if runFastRep then
            if not trackingStarted then
                trackingStarted = true
                startTime = now
                strengthHistory, durabilityHistory = {}, {}
            end
            
            local elapsed = pausedElapsedTime + (now - startTime)
            stopwatchLabel.Text = string.format("%dd %dh %dm %ds - Fast Rep Running",
                math.floor(elapsed / 86400), math.floor((elapsed % 86400) / 3600),
                math.floor((elapsed % 3600) / 60), math.floor(elapsed % 60))
            stopwatchLabel.TextColor3 = Color3.fromRGB(50, 255, 50)
            
            table.insert(strengthHistory, {time = now, value = curStr})
            table.insert(durabilityHistory, {time = now, value = curDur})
            
            while #strengthHistory > 0 and now - strengthHistory[1].time > calculationInterval do
                table.remove(strengthHistory, 1)
            end
            while #durabilityHistory > 0 and now - durabilityHistory[1].time > calculationInterval do
                table.remove(durabilityHistory, 1)
            end
            
            if now - lastCalcTime >= calculationInterval then
                lastCalcTime = now
                if #strengthHistory >= 2 then
                    local delta = strengthHistory[#strengthHistory].value - strengthHistory[1].value
                    local ps = delta / calculationInterval
                    projectedStrengthLabel.Text = "Strength Pace: " .. formatNumber(ps * 3600) .. "/Hour | " .. 
                        formatNumber(ps * 86400) .. "/Day | " .. formatNumber(ps * 604800) .. "/Week"
                end
                if #durabilityHistory >= 2 then
                    local delta = durabilityHistory[#durabilityHistory].value - durabilityHistory[1].value
                    local ps = delta / calculationInterval
                    projectedDurabilityLabel.Text = "Durability Pace: " .. formatNumber(ps * 3600) .. "/Hour | " .. 
                        formatNumber(ps * 86400) .. "/Day | " .. formatNumber(ps * 604800) .. "/Week"
                end
            end
        else
            if trackingStarted then
                trackingStarted = false
                pausedElapsedTime = pausedElapsedTime + (now - startTime)
                stopwatchLabel.TextColor3 = Color3.fromRGB(255, 165, 0)
            end
        end
        task.wait(0.05)
    end
end)

StrengthFolder:AddLabel("")
StrengthFolder:AddLabel("Fast Farm").TextSize = 20

StrengthFolder:AddSwitch("Fast Farm", function(state)
    getgenv()._AutoRepFarmEnabled = state
    runFastRep = state
    if state then
        pausedElapsedTime = 0
        trackingStarted = false
        initialStrength = strengthStat.Value
        initialDurability = durabilityStat.Value
        stopwatchLabel.Text = "0d 0h 0m 0s - Fast Rep Running"
        stopwatchLabel.TextColor3 = Color3.fromRGB(50, 255, 50)
    else
        stopwatchLabel.TextColor3 = Color3.fromRGB(255, 165, 0)
    end
end)

local PET_NAME, ROCK_NAME, PROTEIN_EGG_NAME = "Swift Samurai", "Rock5M", "ProteinEgg"
local PROTEIN_EGG_INTERVAL = 1800
local REPS_PER_CYCLE = 85
local REP_DELAY = 0.001
local ROCK_INTERVAL = 1
local MAX_PING = 3000

local HumanoidRootPart, RockRef
local lastProteinEggTime = 0
local lastRockTime = 0

local function getPing()
    local ok, ping = pcall(function()
        return Stats.Network.ServerStatsItem["Data Ping"]:GetValue()
    end)
    return ok and ping or 999
end

local function updateCharacter()
    local char = Player.Character or Player.CharacterAdded:Wait()
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart", 5)
end

local function equipPet()
    local folder = Player:FindFirstChild("petsFolder")
    if folder and folder:FindFirstChild("Unique") then
        for _, pet in pairs(folder.Unique:GetChildren()) do
            if pet.Name == PET_NAME then
                RS.rEvents.equipPetEvent:FireServer("equipPet", pet)
                break
            end
        end
    end
end

local function eatProteinEgg()
    for _, item in pairs(Player.Backpack:GetChildren()) do
        if item.Name == PROTEIN_EGG_NAME then
            RS.rEvents.eatEvent:FireServer("eat", item)
            break
        end
    end
end

local function hitRock()
    if not RockRef or not RockRef.Parent then
        RockRef = workspace:FindFirstChild(ROCK_NAME)
    end
    if RockRef and HumanoidRootPart then
        HumanoidRootPart.CFrame = RockRef.CFrame * CFrame.new(0, 0, -5)
        RS.rEvents.hitEvent:FireServer("hit", RockRef)
    end
end

if not getgenv()._AutoRepFarmLoop then
    getgenv()._AutoRepFarmLoop = true
    task.spawn(function()
        updateCharacter()
        equipPet()
        lastProteinEggTime = tick()
        lastRockTime = tick()
        
        while true do
            if getgenv()._AutoRepFarmEnabled and getPing() <= MAX_PING then
                if Player:FindFirstChild("muscleEvent") then
                    for i = 1, REPS_PER_CYCLE do
                        Player.muscleEvent:FireServer("rep")
                    end
                end
                if tick() - lastProteinEggTime >= PROTEIN_EGG_INTERVAL then
                    eatProteinEgg()
                    lastProteinEggTime = tick()
                end
                if tick() - lastRockTime >= ROCK_INTERVAL then
                    hitRock()
                    lastRockTime = tick()
                end
            end
            task.wait(REP_DELAY)
        end
    end)
end

StrengthFolder:AddLabel("")
StrengthFolder:AddLabel("Misc:").TextSize = 20

local function unequipPets()
    for _, folder in pairs(Player.petsFolder:GetChildren()) do
        if folder:IsA("Folder") then
            for _, pet in pairs(folder:GetChildren()) do
                RS.rEvents.equipPetEvent:FireServer("unequipPet", pet)
            end
        end
    end
    task.wait(0.1)
end

local function equipPetsByName(name)
    unequipPets()
    task.wait(0.01)
    for _, pet in pairs(Player.petsFolder.Unique:GetChildren()) do
        if pet.Name == name then
            RS.rEvents.equipPetEvent:FireServer("equipPet", pet)
        end
    end
end

local eggRunning = false
task.spawn(function()
    while true do
        if eggRunning then
            local tool = Player.Character:FindFirstChild("Protein Egg") or Player.Backpack:FindFirstChild("Protein Egg")
            if tool then muscleEvent:FireServer("proteinEgg", tool) end
            task.wait(1800)
        else
            task.wait(1)
        end
    end
end)

StrengthFolder:AddSwitch("Auto Egg", function(state)
    eggRunning = state
end)

local shakeRunning2 = false
task.spawn(function()
    while true do
        if shakeRunning2 then
            local tool = Player.Character:FindFirstChild("Tropical Shake") or Player.Backpack:FindFirstChild("Tropical Shake")
            if tool then muscleEvent:FireServer("tropicalShake", tool) end
            task.wait(900)
        else
            task.wait(1)
        end
    end
end)

StrengthFolder:AddSwitch("Auto Shake", function(state)
    shakeRunning2 = state
end)

StrengthFolder:AddSwitch("Spin Fortune Wheel", function(bool)
    _G.AutoSpinWheel2 = bool
    if bool then
        spawn(function()
            while _G.AutoSpinWheel2 and wait(1) do
                RS.rEvents.openFortuneWheelRemote:InvokeServer("openFortuneWheel", RS.fortuneWheelChances["Fortune Wheel"])
            end
        end)
    end
end)

StrengthFolder:AddSwitch("Hide All Frames", function(bool)
    for _, obj in pairs(RS:GetChildren()) do
        if obj.Name:match("Frame$") then
            obj.Visible = not bool
        end
    end
end)

StrengthFolder:AddButton("Jungle Squat", function()
    local char = Player.Character or Player.CharacterAdded:wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    hrp.CFrame = CFrame.new(-8371.43359375, 6.79806327, 2858.88525390)
    task.wait(0.2)
    VIM:SendKeyEvent(true, Enum.KeyCode.E, false, game)
    task.wait(0.05)
    VIM:SendKeyEvent(false, Enum.KeyCode.E, false, game)
end)

StrengthFolder:AddButton("Anti Lag", function()
    for _, gui in pairs(Player.PlayerGui:GetChildren()) do
        if gui:IsA("ScreenGui") then gui:Destroy() end
    end
    
    local lighting = game:GetService("Lighting")
    for _, v in pairs(lighting:GetChildren()) do
        if v:IsA("Sky") then v:Destroy() end
    end
    
    local darkSky = Instance.new("Sky")
    darkSky.Name = "DarkSky"
    for _, prop in pairs({"SkyboxBk", "SkyboxDn", "SkyboxFt", "SkyboxLf", "SkyboxRt", "SkyboxUp"}) do
        darkSky[prop] = "rbxassetid://0"
    end
    darkSky.Parent = lighting
    
    lighting.Brightness = 0
    lighting.ClockTime = 0
    
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("ParticleEmitter") or obj:IsA("PointLight") or obj:IsA("SpotLight") or obj:IsA("SurfaceLight") then
            obj:Destroy()
        end
    end
end)

StrengthFolder:AddButton("Equip Swift Samurai", function()
    unequipPets()
    equipPetsByName("Swift Samurai")
end)

-- ========================================
-- TAB STATS
-- ========================================
local estadisticas = window:AddTab("Stats")
local SelectPlayerName = ""

local PlayerDrop = estadisticas:AddDropdown("Select Player", function(Value)
    SelectPlayerName = Value:match("| (.+)")
end)

local function AddPlayerToDropdown(plr)
    PlayerDrop:Add(plr.DisplayName .. " | " .. plr.Name)
end

for _, plr in ipairs(Players:GetPlayers()) do
    AddPlayerToDropdown(plr)
end

Players.PlayerAdded:Connect(function(plr)
    task.wait(0.2)
    AddPlayerToDropdown(plr)
end)

Players.PlayerRemoving:Connect(function(plr)
    if SelectPlayerName == plr.Name then
        SelectPlayerName = ""
    end
end)

local function FormatDisplay(value)
    return "[ " .. tostring(math.floor(value)):reverse():gsub("(%d%d%d)", "%1,"):reverse():gsub("^,", "") .. " | " .. formatNumber(value) .. " ]"
end

local labels = {}
for i = 0, 13 do
    labels[i] = estadisticas:AddLabel("")
end

task.spawn(function()
    while task.wait() do
        if SelectPlayerName ~= "" then
            local p = Players:FindFirstChild(SelectPlayerName)
            if p then
                if p:FindFirstChild("Gems") then labels[1].Text = "Gems: " .. FormatDisplay(p.Gems.Value) end
                if p:FindFirstChild("Agility") then labels[3].Text = "Agility: " .. FormatDisplay(p.Agility.Value) end
                if p:FindFirstChild("Durability") then labels[4].Text = "Durability: " .. FormatDisplay(p.Durability.Value) end
                if p:FindFirstChild("muscleKingTime") then labels[6].Text = "Muscle King Time: " .. FormatDisplay(p.muscleKingTime.Value) end
                if p:FindFirstChild("customSize") then labels[10].Text = "Custom Size: " .. FormatDisplay(p.customSize.Value) end
                if p:FindFirstChild("customSpeed") then labels[11].Text = "Custom Speed: " .. FormatDisplay(p.customSpeed.Value) end
                if p:FindFirstChild("evilKarma") then labels[12].Text = "Evil Karma: " .. FormatDisplay(p.evilKarma.Value) end
                if p:FindFirstChild("goodKarma") then labels[13].Text = "Good Karma: " .. FormatDisplay(p.goodKarma.Value) end
                
                local ls = p:FindFirstChild("leaderstats")
                if ls then
                    if ls:FindFirstChild("Strength") then labels[0].Text = "Strength: " .. FormatDisplay(ls.Strength.Value) end
                    if ls:FindFirstChild("Rebirths") then labels[2].Text = "Rebirths: " .. FormatDisplay(ls.Rebirths.Value) end
                    if ls:FindFirstChild("Kills") then labels[5].Text = "Kills: " .. FormatDisplay(ls.Kills.Value) end
                end
                
                labels[9].Text = p:FindFirstChild("currentMap") and ("Current Map: " .. tostring(p.currentMap.Value)) or "Current Map: N/A"
            end
        end
    end
end)

estadisticas:AddLabel("————————————————————————————")
estadisticas:AddLabel("Advanced Stats:").TextSize = 24

local enemyHealthLabel = estadisticas:AddLabel("Enemy Health: N/A")
local playerDamageLabel = estadisticas:AddLabel("Your Damage: N/A")
local hitsToKillLabel = estadisticas:AddLabel("Hits to Kill: N/A")

local function calculateEnemyHealth(targetPlayer)
    if not targetPlayer then return 0 end
    local durability = targetPlayer:FindFirstChild("Durability") or (targetPlayer:FindFirstChild("leaderstats") and targetPlayer.leaderstats:FindFirstChild("Durability"))
    local baseDura = durability and durability.Value or 0
    local multiplier = 1
    local ult = targetPlayer:FindFirstChild("ultimatesFolder")
    if ult and ult:FindFirstChild("Infernal Health") then
        multiplier = multiplier + (0.15 * ult["Infernal Health"].Value)
    end
    return baseDura * multiplier
end

local function calculateLocalPlayerDamage()
    local ls = Player:FindFirstChild("leaderstats")
    if not ls or not ls:FindFirstChild("Strength") then return 0 end
    local baseDamage = ls.Strength.Value * 0.0667
    local multiplier = 1
    local ult = Player:FindFirstChild("ultimatesFolder")
    if ult and ult:FindFirstChild("Demon Damage") then
        multiplier = multiplier + math.min(0.1 * ult["Demon Damage"].Value, 0.5)
    end
    return baseDamage * multiplier
end

local function calculateHitsToKill(health, damage)
    if damage <= 0 then return "∞" end
    local hits = math.ceil(health / damage)
    return hits > 50 and "∞" or (hits < 1 and 1 or hits)
end

task.spawn(function()
    while task.wait(0.3) do
        local target = Players:FindFirstChild(SelectPlayerName)
        if target then
            local hp = calculateEnemyHealth(target)
            local dmg = calculateLocalPlayerDamage()
            enemyHealthLabel.Text = "Enemy Health: " .. FormatDisplay(hp)
            playerDamageLabel.Text = "Your Damage: " .. FormatDisplay(dmg)
            hitsToKillLabel.Text = "Hits to Kill: " .. tostring(calculateHitsToKill(hp, dmg))
        else
            enemyHealthLabel.Text = "Enemy Health: N/A"
            playerDamageLabel.Text = "Your Damage: N/A"
            hitsToKillLabel.Text = "Hits to Kill: N/A"
        end
    end
end)

-- ========================================
-- TAB MISC
-- ========================================
local MiscTab = window:AddTab("Misc")
local misc1Folder = MiscTab:AddFolder("  Misc 1")

local sizeValue, speedValue = 2, 16
local autoSizeEnabled, autoSpeedEnabled = false, false

misc1Folder:AddTextBox("Auto Size", function(text)
    sizeValue = tonumber(text) or 2
    if autoSizeEnabled then
        pcall(function()
            RS.rEvents.changeSpeedSizeRemote:InvokeServer("changeSize", sizeValue)
        end)
    end
end)

misc1Folder:AddSwitch("Auto Set Size", function(bool)
    autoSizeEnabled = bool
    if autoSizeEnabled then
        spawn(function()
            while autoSizeEnabled do
                pcall(function()
                    RS.rEvents.changeSpeedSizeRemote:InvokeServer("changeSize", sizeValue)
                end)
                wait(0.1)
            end
        end)
    end
end)

misc1Folder:AddTextBox("Auto Speed", function(text)
    speedValue = tonumber(text) or 16
    if Player and Player.Character and Player.Character:FindFirstChild("Humanoid") then
        Player.Character.Humanoid.WalkSpeed = speedValue
    end
end)

misc1Folder:AddSwitch("Auto Set Speed", function(bool)
    autoSpeedEnabled = bool
    if autoSpeedEnabled then
        if Player and Player.Character and Player.Character:FindFirstChild("Humanoid") then
            Player.Character.Humanoid.WalkSpeed = speedValue
        end
        Player.CharacterAdded:Connect(function(character)
            local humanoid = character:WaitForChild("Humanoid")
            if humanoid and autoSpeedEnabled then
                humanoid.WalkSpeed = speedValue
            end
        end)
    end
end)

local Misc2 = MiscTab:AddFolder("  Misc 2")

local scripts = {
    {"Infinite Yield", "https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"},
    {"GhostX Hub", "https://scriptblox.com/raw/Universal-Script-GhostX-Hub-7158"},
    {"Permanent Shiftlock", "https://pastebin.com/raw/CjNsnSDy"},
    {"All Emotes", "https://raw.githubusercontent.com/7yd7/Hub/refs/heads/Branch/GUIS/Emotes.lua"}
}

for _, script in ipairs(scripts) do
    Misc2:AddButton(script[1], function()
        loadstring(game:HttpGet(script[2]))()
    end)
end

local misc3Folder = MiscTab:AddFolder("  Misc 3")

local noclipEnabled, infiniteJumpEnabled = false, false
local noclipConnection, infiniteJumpConnection

local function toggleNoclip(enabled)
    local character = Player.Character or Player.CharacterAdded:Wait()
    if enabled then
        local originalCanCollide = {}
        noclipConnection = RunService.Stepped:Connect(function()
            if character and character:FindFirstChild("HumanoidRootPart") then
                for _, part in pairs(character:GetChildren()) do
                    if part:IsA("BasePart") then
                        if originalCanCollide[part] == nil then
                            originalCanCollide[part] = part.CanCollide
                        end
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
    end
end

local function toggleInfiniteJump(enabled)
    if enabled then
        infiniteJumpConnection = game:GetService("UserInputService").JumpRequest:Connect(function()
            local character = Player.Character
            if character and character:FindFirstChild("Humanoid") then
                character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end)
    else
        if infiniteJumpConnection then
            infiniteJumpConnection:Disconnect()
            infiniteJumpConnection = nil
        end
    end
end

misc3Folder:AddSwitch("No-Clip", function(enabled)
    noclipEnabled = enabled
    toggleNoclip(enabled)
end)

misc3Folder:AddSwitch("Infinite Jump", function(enabled)
    infiniteJumpEnabled = enabled
    toggleInfiniteJump(enabled)
end)

local timeDropdown = misc3Folder:AddDropdown("Change Time", function(selection)
    local lighting = game:GetService("Lighting")
    if selection == "Night" then
        lighting.ClockTime = 0
    elseif selection == "Day" then
        lighting.ClockTime = 12
    elseif selection == "Midnight" then
        lighting.ClockTime = 6
    end
end)

timeDropdown:Add("Night")
timeDropdown:Add("Day")
timeDropdown:Add("Midnight")

local misc4Folder = MiscTab:AddFolder("  Misc 4")

misc4Folder:AddButton("Rejoin Server", function()
    local TeleportService = game:GetService("TeleportService")
    local success, result = pcall(function()
        TeleportService:TeleportToPlaceInstance(game.PlaceId, nil, Player)
    end)
    if not success then
        TeleportService:Teleport(game.PlaceId, Player)
    end
end)

misc4Folder:AddButton("Remove Portals", function()
    for _, portal in pairs(game:GetDescendants()) do
        if portal.Name == "RobloxForwardPortals" then
            portal:Destroy()
        end
    end
    if _G.AdRemovalConnection then
        _G.AdRemovalConnection:Disconnect()
    end
    _G.AdRemovalConnection = game.DescendantAdded:Connect(function(descendant)
        if descendant.Name == "RobloxForwardPortals" then
            descendant:Destroy()
        end
    end)
end)

local parts = {}
local partSize, totalDistance = 2048, 50000
local startPosition = Vector3.new(-2, -9.5, -2)
local numberOfParts = math.ceil(totalDistance / partSize)

local function createParts()
    for x = 0, numberOfParts - 1 do
        for z = 0, numberOfParts - 1 do
            local positions = {
                {x * partSize, z * partSize, "Side"},
                {-x * partSize, z * partSize, "LeftRight"},
                {-x * partSize, -z * partSize, "UpLeft"},
                {x * partSize, -z * partSize, "UpRight"}
            }
            for _, pos in ipairs(positions) do
                local newPart = Instance.new("Part")
                newPart.Size = Vector3.new(partSize, 1, partSize)
                newPart.Position = startPosition + Vector3.new(pos[1], 0, pos[2])
                newPart.Anchored = true
                newPart.Transparency = 1
                newPart.CanCollide = true
                newPart.Name = "Part_" .. pos[3] .. "_" .. x .. "_" .. z
                newPart.Parent = workspace
                table.insert(parts, newPart)
            end
        end
    end
end

local function makePartsWalkthrough()
    for _, part in ipairs(parts) do
        if part and part.Parent then
            part.CanCollide = false
        end
    end
end

misc4Folder:AddSwitch("Full Walk on Water", function(bool)
    if bool then
        createParts()
    else
        makePartsWalkthrough()
    end
end)

-- ========================================
-- TAB PETS
-- ========================================
local pets = window:AddTab("Pets")

local crystalData = {
    ["Blue Crystal"] = {"Blue Birdie", "Orange Hedgehog", "Blue Aura", "Red Kitty", "Dark Vampy", "Blue Bunny", "Red Aura", "Green Aura", "Purple Aura", "Yellow Aura"},
    ["Green Crystal"] = {"Silver Dog", "Green Aura", "Dark Golem", "Green Butterfly", "Crimson Falcon", "Red Aura", "Blue Aura", "Purple Aura", "Yellow Aura"},
    ["Frost Crystal"] = {"Yellow Butterfly", "Purple Dragon", "Blue Pheonix", "Orange Pegasus", "Lightning", "Electro"},
    ["Mythical Crystal"] = {"Purple Falcon", "Red Dragon", "Blue Firecaster", "Golden Pheonix", "Power Lightning", "Dark Lightning"},
    ["Inferno Crystal"] = {"Red Firecaster", "Infernal Dragon", "White Pegasus", "Golden Pheonix", "Inferno", "Dark Storm"},
    ["Legends Crystal"] = {"Ultra Birdie", "Magic Butterfly", "Green Firecaster", "White Pheonix", "Supernova", "Purple Nova"},
    ["Muscle Elite Crystal"] = {"Frostwave Legends Penguin", "Phantom Genesis Dragon", "Dark Legends Manticore", "Ultimate Supernova Pegasus", "Aether Spirit Bunny", "Cybernetic Showdown Dragon"},
    ["Galaxy Oracle Crystal"] = {"Eternal Strike Leviathan", "Lightning Strike Phantom", "Darkstar Hunter", "Muscle King", "Azure Tundra", "Ultra Inferno"},
    ["Jungle Crystal"] = {"Entropic Blast", "Muscle Sensei", "Grand Supernova", "Neon Guardian", "Eternal Megastrike", "Golden Viking", "Astral Electro", "Dark Electro", "Enchanted Mirage", "Ultra Mirage", "Unstable Mirage"}
}

local function findCrystalForItem(itemName)
    for crystalName, pets in pairs(crystalData) do
        for _, pet in ipairs(pets) do
            if pet == itemName then
                return crystalName
            end
        end
    end
    return nil
end

local selectedPet, selectedAura = "", ""

pets:AddLabel("=== Buy pets and auras ===")

local petDropdown = pets:AddDropdown("Select pet", function(text)
    selectedPet = text
end)

for rarity, petList in pairs(CONFIG.Pets) do
    for _, pet in ipairs(petList) do
        petDropdown:Add(pet .. " (" .. rarity .. ")")
    end
end

local auraDropdown = pets:AddDropdown("Select Aura", function(text)
    selectedAura = text
end)

for rarity, auraList in pairs(CONFIG.Auras) do
    for _, aura in ipairs(auraList) do
        auraDropdown:Add(aura .. " (" .. rarity .. ")")
    end
end

pets:AddLabel("=== System to buys===")

pets:AddSwitch("Auto Buy Pet", function(bool)
    _G.AutoBuyPet = bool
    if bool then
        if selectedPet == "" then return end
        local petName = selectedPet:match("^(.-)%s*%(") or selectedPet
        spawn(function()
            while _G.AutoBuyPet and selectedPet ~= "" do
                local petToBuy = RS.cPetShopFolder:FindFirstChild(petName)
                if petToBuy then
                    RS.cPetShopRemote:InvokeServer(petToBuy)
                end
                task.wait(0.1)
            end
        end)
    end
end)

pets:AddSwitch("Auto buy Aura", function(bool)
    _G.AutoBuyAura = bool
    if bool then
        if selectedAura == "" then return end
        local auraName = selectedAura:match("^(.-)%s*%(") or selectedAura
        spawn(function()
            while _G.AutoBuyAura and selectedAura ~= "" do
                local auraToBuy = RS.cPetShopFolder:FindFirstChild(auraName)
                if auraToBuy then
                    RS.cPetShopRemote:InvokeServer(auraToBuy)
                end
                task.wait(0.1)
            end
        end)
    end
end)

pets:AddLabel("=== buy ultimates ===")

local selectedUltimate = ""

local ultimateDropdown = pets:AddDropdown("Select ultimate", function(text)
    selectedUltimate = text
end)

for _, ultimate in ipairs(CONFIG.Ultimates) do
    ultimateDropdown:Add(ultimate)
end

pets:AddSwitch("Auto Buy Ultimates", function(bool)
    _G.AutoUpgradeUltimate = bool
    if bool then
        if selectedUltimate == "" then return end
        spawn(function()
            while _G.AutoUpgradeUltimate and selectedUltimate ~= "" do
                RS.rEvents.ultimatesRemote:InvokeServer("upgradeUltimate", selectedUltimate)
                task.wait(1)
            end
        end)
    end
end)

-- ========================================
-- TABS RESTANTES (PLACEHOLDER)
-- ========================================

-- ========================================
-- TAB DATA - CALCULATORS
-- ========================================
local DataTab = window:AddTab("Data")

local calculatorData = {
    {name = "Strength", folder = nil, labels = {}, active = false, startTime = 0, startValue = 0, 
     getValue = function() return Player.leaderstats.Strength.Value end},
    {name = "Durability", folder = nil, labels = {}, active = false, startTime = 0, startValue = 0,
     getValue = function() return Player.Durability.Value end},
    {name = "Rebirths", folder = nil, labels = {}, active = false, startTime = 0, startValue = 0,
     getValue = function() return Player.leaderstats.Rebirths.Value end},
    {name = "Kills", folder = nil, labels = {}, active = false, startTime = 0, startValue = 0,
     getValue = function() return Player.leaderstats.Kills.Value end},
    {name = "Brawls", folder = nil, labels = {}, active = false, startTime = 0, startValue = 0,
     getValue = function() return Player.leaderstats.Brawls.Value end}
}

local function formatFull(num)
    local formatted = tostring(math.floor(num))
    local k
    while true do
        formatted, k = formatted:gsub("^(-?%d+)(%d%d%d)", "%1,%2")
        if k == 0 then break end
    end
    return formatted
end

local function formatNumberCalc(num)
    if num == math.huge then return "∞"
    elseif num == 0 then return "0"
    elseif num < 0.01 and num > 0 then return "~0" end
    
    local abs = math.abs(num)
    local sign = num < 0 and "-" or ""
    local value, suffix
    
    if abs >= 1e30 then value, suffix = abs / 1e30, "No"
    elseif abs >= 1e27 then value, suffix = abs / 1e27, "Oc"
    elseif abs >= 1e24 then value, suffix = abs / 1e24, "Sp"
    elseif abs >= 1e21 then value, suffix = abs / 1e21, "Sx"
    elseif abs >= 1e18 then value, suffix = abs / 1e18, "Qt"
    elseif abs >= 1e15 then value, suffix = abs / 1e15, "Qd"
    elseif abs >= 1e12 then value, suffix = abs / 1e12, "T"
    elseif abs >= 1e9 then value, suffix = abs / 1e9, "B"
    elseif abs >= 1e6 then value, suffix = abs / 1e6, "M"
    elseif abs >= 1e3 then value, suffix = abs / 1e3, "K"
    else value, suffix = abs, "" end
    
    return sign .. string.format("%.2f", value) .. suffix
end

local function formatDisplayCalc(num)
    return formatNumberCalc(num) .. " 【" .. formatFull(num) .. "】"
end

for _, calc in ipairs(calculatorData) do
    calc.folder = DataTab:AddFolder(calc.name)
    calc.labels = {
        status = calc.folder:AddLabel("Status: ⏸ Presiona Start"),
        current = calc.folder:AddLabel("Current: 0"),
        gained = calc.folder:AddLabel("Gained: 0"),
        separator = calc.folder:AddLabel("───────────────"),
        perMinute = calc.folder:AddLabel("Per Minute: 0"),
        perHour = calc.folder:AddLabel("Per Hour: 0"),
        perDay = calc.folder:AddLabel("Per Day: 0")
    }
    
    for _, lbl in pairs(calc.labels) do
        if lbl ~= calc.labels.separator then
            lbl.TextSize = 17
        end
    end
    
    calc.folder:AddButton("▶ Start " .. calc.name, function()
        calc.active = true
        calc.startTime = tick()
        calc.startValue = calc.getValue()
        calc.labels.status.Text = "Status: ⏱ Calculando..."
    end)
    
    calc.folder:AddButton("⏸ Stop " .. calc.name, function()
        calc.active = false
        calc.startTime = 0
        calc.startValue = 0
        calc.labels.status.Text = "Status: ⏸ Detenido"
    end)
end

DataTab:AddButton("🔄 Reset All Calculators", function()
    for _, calc in ipairs(calculatorData) do
        calc.active = false
        calc.startTime = 0
        calc.startValue = 0
        calc.labels.status.Text = "Status: ⏸ Presiona Start"
        calc.labels.gained.Text = "Gained: 0"
        calc.labels.perMinute.Text = "Per Minute: 0"
        calc.labels.perHour.Text = "Per Hour: 0"
        calc.labels.perDay.Text = "Per Day: 0"
    end
end)

task.spawn(function()
    while true do
        for _, calc in ipairs(calculatorData) do
            local currentValue = calc.getValue()
            calc.labels.current.Text = "Current: " .. formatDisplayCalc(currentValue)
            
            if calc.active and calc.startTime > 0 then
                local timeElapsed = tick() - calc.startTime
                local gained = currentValue - calc.startValue
                calc.labels.gained.Text = "Gained: " .. formatDisplayCalc(gained)
                
                if timeElapsed >= 60 then
                    local perMinute = (gained / timeElapsed) * 60
                    local perHour = perMinute * 60
                    local perDay = perHour * 24
                    calc.labels.status.Text = "Status: ✅ Activo"
                    calc.labels.perMinute.Text = "Per Minute: " .. formatDisplayCalc(perMinute)
                    calc.labels.perHour.Text = "Per Hour: " .. formatDisplayCalc(perHour)
                    calc.labels.perDay.Text = "Per Day: " .. formatDisplayCalc(perDay)
                else
                    local remaining = 60 - timeElapsed
                    calc.labels.status.Text = "Status: ⏱ Calculando " .. math.ceil(remaining) .. "s"
                    calc.labels.perMinute.Text = "Per Minute: Calculando..."
                    calc.labels.perHour.Text = "Per Hour: Calculando..."
                    calc.labels.perDay.Text = "Per Day: Calculando..."
                end
            else
                calc.labels.gained.Text = "Gained: 0"
                calc.labels.perMinute.Text = "Per Minute: 0"
                calc.labels.perHour.Text = "Per Hour: 0"
                calc.labels.perDay.Text = "Per Day: 0"
            end
        end
        task.wait(1)
    end
end)

-- ========================================
-- TAB GIFT
-- ========================================
local GiftTab = window:AddTab("Gift")

local giftData = {
    egg = {player = nil, count = 0, itemName = "Protein Egg", label = nil, dropdown = nil},
    shake = {player = nil, count = 0, itemName = "Tropical Shake", label = nil, dropdown = nil}
}

GiftTab:AddLabel("Gifting Protein egg:").TextSize = 22
giftData.egg.label = GiftTab:AddLabel("Protein Eggs: 0")
giftData.egg.label.TextSize = 20

giftData.egg.dropdown = GiftTab:AddDropdown("Player to Gift Eggs", function(selectedText)
    local playerName = selectedText:match("| (.+)")
    if playerName then
        for _, plr in ipairs(Players:GetPlayers()) do
            if plr.Name == playerName then
                giftData.egg.player = plr
                break
            end
        end
    end
end)

for _, plr in ipairs(Players:GetPlayers()) do
    if plr ~= Player then
        giftData.egg.dropdown:Add(plr.DisplayName .. " | " .. plr.Name)
    end
end

Players.PlayerAdded:Connect(function(plr)
    if plr ~= Player then
        task.wait(0.2)
        giftData.egg.dropdown:Add(plr.DisplayName .. " | " .. plr.Name)
        giftData.shake.dropdown:Add(plr.DisplayName .. " | " .. plr.Name)
    end
end)

GiftTab:AddTextBox("Amount of Eggs", function(text)
    giftData.egg.count = tonumber(text) or 0
end)

GiftTab:AddButton("Gift Eggs", function()
    if not giftData.egg.player or giftData.egg.count <= 0 then return end
    local consumables = Player:FindFirstChild("consumablesFolder")
    if not consumables then return end
    
    for i = 1, giftData.egg.count do
        local egg = consumables:FindFirstChild(giftData.egg.itemName)
        if egg and egg:IsA("Instance") then
            local success = pcall(function()
                RS.rEvents.giftRemote:InvokeServer("giftRequest", giftData.egg.player, egg)
            end)
            if not success then break end
        else
            break
        end
        task.wait(0.15)
    end
end)

GiftTab:AddLabel("Gifting Tropical Shakes:").TextSize = 22
giftData.shake.label = GiftTab:AddLabel("Tropical Shakes: 0")
giftData.shake.label.TextSize = 18

giftData.shake.dropdown = GiftTab:AddDropdown("Player to Gift Tropical Shakes", function(selectedText)
    local playerName = selectedText:match("| (.+)")
    if playerName then
        for _, plr in ipairs(Players:GetPlayers()) do
            if plr.Name == playerName then
                giftData.shake.player = plr
                break
            end
        end
    end
end)

for _, plr in ipairs(Players:GetPlayers()) do
    if plr ~= Player then
        giftData.shake.dropdown:Add(plr.DisplayName .. " | " .. plr.Name)
    end
end

GiftTab:AddTextBox("Tropical Shakes gift", function(text)
    giftData.shake.count = tonumber(text) or 0
end)

GiftTab:AddButton("Gift Tropical Shakes", function()
    if not giftData.shake.player or giftData.shake.count <= 0 then return end
    for i = 1, giftData.shake.count do
        local shake = Player.consumablesFolder:FindFirstChild(giftData.shake.itemName)
        if shake then
            RS.rEvents.giftRemote:InvokeServer("giftRequest", giftData.shake.player, shake)
            task.wait(0.1)
        else
            break
        end
    end
end)

local function updateItemCount()
    local proteinEggCount, tropicalShakeCount = 0, 0
    local backpack = Player:WaitForChild("Backpack")
    if backpack then
        for _, item in ipairs(backpack:GetChildren()) do
            if item.Name == "Protein Egg" then
                proteinEggCount = proteinEggCount + 1
            elseif item.Name == "Tropical Shake" or item.Name == "Piñas" then
                tropicalShakeCount = tropicalShakeCount + 1
            end
        end
    end
    giftData.egg.label.Text = "Protein Eggs: " .. proteinEggCount
    giftData.shake.label.Text = "Tropical Shakes: " .. tropicalShakeCount
end

task.spawn(function()
    while true do
        updateItemCount()
        task.wait(0.25)
    end
end)

local autoEatBoostsEnabled = false
local boostsList = {"ULTRA Shake", "TOUGH Bar", "Protein Shake", "Energy Shake", "Protein Bar", "Energy Bar", "Tropical Shake"}

local function eatAllBoosts()
    local backpack = Player:WaitForChild("Backpack")
    local character = Player.Character or Player.CharacterAdded:Wait()
    for _, boostName in ipairs(boostsList) do
        local boost = backpack:FindFirstChild(boostName)
        while boost do
            boost.Parent = character
            pcall(function() boost:Activate() end)
            task.wait(0)
            boost = backpack:FindFirstChild(boostName)
        end
    end
end

task.spawn(function()
    while true do
        if autoEatBoostsEnabled then
            eatAllBoosts()
            task.wait(2)
        else
            task.wait(1)
        end
    end
end)

GiftTab:AddSwitch("Auto Clear Inventory", function(state)
    autoEatBoostsEnabled = state
end)

-- ========================================
-- TABS FINALES (PLACEHOLDER)
-- ========================================

-- ========================================
-- TAB KILLER
-- ========================================
local KillerTab = window:AddTab("Killer")

local titleLabel = KillerTab:AddLabel("Kill Aura")
titleLabel.TextSize = 24

_G.whitelistedPlayers = _G.whitelistedPlayers or {}
_G.blacklistedPlayers = _G.blacklistedPlayers or {}
_G.deathRingRange = 20
_G.showDeathRing = false

local ringPart = nil
local spying = false
local targetPlayerName = ""

local function isWhitelisted(player)
    for _, name in ipairs(_G.whitelistedPlayers) do
        if name:lower() == player.Name:lower() then return true end
    end
    return false
end

local function isBlacklisted(player)
    for _, name in ipairs(_G.blacklistedPlayers) do
        if name:lower() == player.Name:lower() then return true end
    end
    return false
end

local function getPlayerDisplayText(player)
    return player.DisplayName .. " | " .. player.Name
end

local function isPlayerAlive(player)
    return player.Character and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0
end

local function checkCharacter()
    return Player.Character
end

local function killPlayer(target)
    if not target or not target.Character then return end
    local char = Player.Character
    if not char then return end
    local lh, rh = char:FindFirstChild("LeftHand"), char:FindFirstChild("RightHand")
    local root = target.Character:FindFirstChild("HumanoidRootPart")
    if lh and rh and root then
        pcall(function()
            firetouchinterest(lh, root, 0)
            firetouchinterest(rh, root, 0)
            task.wait()
            firetouchinterest(lh, root, 1)
            firetouchinterest(rh, root, 1)
        end)
    end
end

local petDropdown = KillerTab:AddDropdown("Select Pet", function(text)
    local petsFolder = Player.petsFolder
    for _, folder in pairs(petsFolder:GetChildren()) do
        if folder:IsA("Folder") then
            for _, pet in pairs(folder:GetChildren()) do
                RS.rEvents.equipPetEvent:FireServer("unequipPet", pet)
            end
        end
    end
    task.wait(0.2)
    local petsToEquip = {}
    for _, pet in pairs(Player.petsFolder.Unique:GetChildren()) do
        if pet.Name == text then
            table.insert(petsToEquip, pet)
        end
    end
    for i = 1, math.min(8, #petsToEquip) do
        RS.rEvents.equipPetEvent:FireServer("equipPet", petsToEquip[i])
        task.wait(0.1)
    end
end)
petDropdown:Add("Wild Wizard")
petDropdown:Add("Mighty Monster")

KillerTab:AddButton("Remove Punch Anim", function()
    local blockedAnimations = {
        ["rbxassetid://3638729053"] = true,
        ["rbxassetid://3638767427"] = true,
    }
    
    local function setupAnimationBlocking()
        local char = Player.Character
        if not char or not char:FindFirstChild("Humanoid") then return end
        local humanoid = char:FindFirstChild("Humanoid")
        
        for _, track in pairs(humanoid:GetPlayingAnimationTracks()) do
            if track.Animation then
                local animId = track.Animation.AnimationId
                local animName = track.Name:lower()
                if blockedAnimations[animId] or animName:match("punch") or animName:match("attack") or animName:match("right") then
                    track:Stop()
                end
            end
        end
        
        if not _G.AnimBlockConnection then
            _G.AnimBlockConnection = humanoid.AnimationPlayed:Connect(function(track)
                if track.Animation then
                    local animId = track.Animation.AnimationId
                    local animName = track.Name:lower()
                    if blockedAnimations[animId] or animName:match("punch") or animName:match("attack") or animName:match("right") then
                        track:Stop()
                    end
                end
            end)
        end
    end
    
    local function overrideToolActivation()
        local function processTool(tool)
            if tool and (tool.Name == "Punch" or tool.Name:match("Attack") or tool.Name:match("Right")) then
                if not tool:GetAttribute("ActivatedOverride") then
                    tool:SetAttribute("ActivatedOverride", true)
                    local connection = tool.Activated:Connect(function()
                        task.wait(0.05)
                        local char = Player.Character
                        if char and char:FindFirstChild("Humanoid") then
                            for _, track in pairs(char.Humanoid:GetPlayingAnimationTracks()) do
                                if track.Animation then
                                    local animId = track.Animation.AnimationId
                                    local animName = track.Name:lower()
                                    if blockedAnimations[animId] or animName:match("punch") or animName:match("attack") or animName:match("right") then
                                        track:Stop()
                                    end
                                end
                            end
                        end
                    end)
                    if not _G.ToolConnections then _G.ToolConnections = {} end
                    _G.ToolConnections[tool] = connection
                end
            end
        end
        
        for _, tool in pairs(Player.Backpack:GetChildren()) do processTool(tool) end
        local char = Player.Character
        if char then
            for _, tool in pairs(char:GetChildren()) do
                if tool:IsA("Tool") then processTool(tool) end
            end
        end
        
        if not _G.BackpackAddedConnection then
            _G.BackpackAddedConnection = Player.Backpack.ChildAdded:Connect(function(child)
                if child:IsA("Tool") then
                    task.wait(0.1)
                    processTool(child)
                end
            end)
        end
        
        if not _G.CharacterToolAddedConnection and char then
            _G.CharacterToolAddedConnection = char.ChildAdded:Connect(function(child)
                if child:IsA("Tool") then
                    task.wait(0.1)
                    processTool(child)
                end
            end)
        end
    end
    
    setupAnimationBlocking()
    overrideToolActivation()
    
    if not _G.AnimMonitorConnection then
        _G.AnimMonitorConnection = RunService.Heartbeat:Connect(function()
            if tick() % 0.5 < 0.01 then
                local char = Player.Character
                if char and char:FindFirstChild("Humanoid") then
                    for _, track in pairs(char.Humanoid:GetPlayingAnimationTracks()) do
                        if track.Animation then
                            local animId = track.Animation.AnimationId
                            local animName = track.Name:lower()
                            if blockedAnimations[animId] or animName:match("punch") or animName:match("attack") or animName:match("right") then
                                track:Stop()
                            end
                        end
                    end
                end
            end
        end)
    end
    
    if not _G.CharacterAddedConnection then
        _G.CharacterAddedConnection = Player.CharacterAdded:Connect(function(newChar)
            task.wait(1)
            setupAnimationBlocking()
            overrideToolActivation()
            if _G.CharacterToolAddedConnection then
                _G.CharacterToolAddedConnection:Disconnect()
            end
            _G.CharacterToolAddedConnection = newChar.ChildAdded:Connect(function(child)
                if child:IsA("Tool") then
                    task.wait(0.1)
                    local function processTool(tool)
                        if tool and (tool.Name == "Punch" or tool.Name:match("Attack") or tool.Name:match("Right")) then
                            if not tool:GetAttribute("ActivatedOverride") then
                                tool:SetAttribute("ActivatedOverride", true)
                                local connection = tool.Activated:Connect(function()
                                    task.wait(0.05)
                                    local char = Player.Character
                                    if char and char:FindFirstChild("Humanoid") then
                                        for _, track in pairs(char.Humanoid:GetPlayingAnimationTracks()) do
                                            if track.Animation then
                                                local animId = track.Animation.AnimationId
                                                local animName = track.Name:lower()
                                                if blockedAnimations[animId] or animName:match("punch") or animName:match("attack") or animName:match("right") then
                                                    track:Stop()
                                                end
                                            end
                                        end
                                    end
                                end)
                                if not _G.ToolConnections then _G.ToolConnections = {} end
                                _G.ToolConnections[tool] = connection
                            end
                        end
                    end
                    processTool(child)
                end
            end)
        end)
    end
end)

KillerTab:AddButton("Recover Punch Anim", function()
    local connections = {"AnimBlockConnection", "AnimMonitorConnection", "BackpackAddedConnection", "CharacterToolAddedConnection", "CharacterAddedConnection"}
    for _, conn in ipairs(connections) do
        if _G[conn] then
            _G[conn]:Disconnect()
            _G[conn] = nil
        end
    end
    if _G.ToolConnections then
        for _, conn in pairs(_G.ToolConnections) do
            if conn then conn:Disconnect() end
        end
        _G.ToolConnections = nil
    end
end)

KillerTab:AddLabel("Auto Kill:").TextSize = 22

local whitelistDropdown = KillerTab:AddDropdown("Add to Whitelist", function(selectedText)
    local playerName = selectedText:match("| (.+)$")
    if playerName then
        playerName = playerName:gsub("^%s*(.-)%s*$", "%1")
        for _, name in ipairs(_G.whitelistedPlayers) do
            if name:lower() == playerName:lower() then return end
        end
        table.insert(_G.whitelistedPlayers, playerName)
    end
end)

local blacklistDropdown = KillerTab:AddDropdown("Add to Killlist", function(selectedText)
    local playerName = selectedText:match("| (.+)$")
    if playerName then
        playerName = playerName:gsub("^%s*(.-)%s*$", "%1")
        for _, name in ipairs(_G.blacklistedPlayers) do
            if name:lower() == playerName:lower() then return end
        end
        table.insert(_G.blacklistedPlayers, playerName)
    end
end)

local spyTargetDropdown = KillerTab:AddDropdown("Select View Target", function(text)
    local playerName = text:match("| (.+)$")
    if playerName then
        targetPlayerName = playerName
    end
end)

for _, plr in ipairs(Players:GetPlayers()) do
    if plr ~= Player then
        local displayText = plr.DisplayName .. " | " .. plr.Name
        whitelistDropdown:Add(displayText)
        blacklistDropdown:Add(displayText)
        spyTargetDropdown:Add(displayText)
    end
end

Players.PlayerAdded:Connect(function(plr)
    if plr ~= Player then
        task.wait(0.2)
        local displayText = plr.DisplayName .. " | " .. plr.Name
        whitelistDropdown:Add(displayText)
        blacklistDropdown:Add(displayText)
        spyTargetDropdown:Add(displayText)
    end
end)

KillerTab:AddSwitch("Kill Everyone", function(bool)
    _G.killAll = bool
    if bool then
        if not _G.killAllConnection then
            _G.killAllConnection = RunService.Heartbeat:Connect(function()
                if _G.killAll then
                    for _, player in ipairs(Players:GetPlayers()) do
                        if player ~= Player and not isWhitelisted(player) and isPlayerAlive(player) then
                            killPlayer(player)
                        end
                    end
                end
            end)
        end
    else
        if _G.killAllConnection then
            _G.killAllConnection:Disconnect()
            _G.killAllConnection = nil
        end
    end
end):Set(false)

KillerTab:AddSwitch("Whitelist Friends", function(bool)
    _G.whitelistFriends = bool
    if bool then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= Player and player:IsFriendsWith(Player.UserId) then
                local playerName = player.Name
                local alreadyWhitelisted = false
                for _, name in ipairs(_G.whitelistedPlayers) do
                    if name:lower() == playerName:lower() then
                        alreadyWhitelisted = true
                        break
                    end
                end
                if not alreadyWhitelisted then
                    table.insert(_G.whitelistedPlayers, playerName)
                end
            end
        end
        Players.PlayerAdded:Connect(function(player)
            if _G.whitelistFriends and player:IsFriendsWith(Player.UserId) then
                local playerName = player.Name
                for _, name in ipairs(_G.whitelistedPlayers) do
                    if name:lower() == playerName:lower() then return end
                end
                table.insert(_G.whitelistedPlayers, playerName)
            end
        end)
    end
end):Set(false)

KillerTab:AddLabel("------Karma------")

KillerTab:AddSwitch("Auto Good Karma", function(bool)
    _G.autoGoodKarma = bool
    task.spawn(function()
        while _G.autoGoodKarma do
            local playerChar = Player.Character
            local rightHand = playerChar and playerChar:FindFirstChild("RightHand")
            local leftHand = playerChar and playerChar:FindFirstChild("LeftHand")
            if playerChar and rightHand and leftHand then
                for _, target in ipairs(Players:GetPlayers()) do
                    if target ~= Player then
                        local evilKarma = target:FindFirstChild("evilKarma")
                        local goodKarma = target:FindFirstChild("goodKarma")
                        if evilKarma and goodKarma and evilKarma:IsA("IntValue") and goodKarma:IsA("IntValue") and evilKarma.Value > goodKarma.Value then
                            local rootPart = target.Character and target.Character:FindFirstChild("HumanoidRootPart")
                            if rootPart then
                                pcall(function()
                                    firetouchinterest(rightHand, rootPart, 1)
                                    firetouchinterest(leftHand, rootPart, 1)
                                    firetouchinterest(rightHand, rootPart, 0)
                                    firetouchinterest(leftHand, rootPart, 0)
                                end)
                            end
                        end
                    end
                end
            end
            task.wait(0.01)
        end
    end)
end)

KillerTab:AddSwitch("Auto Bad Karma", function(bool)
    _G.autoBadKarma = bool
    task.spawn(function()
        while _G.autoBadKarma do
            local playerChar = Player.Character
            local rightHand = playerChar and playerChar:FindFirstChild("RightHand")
            local leftHand = playerChar and playerChar:FindFirstChild("LeftHand")
            if playerChar and rightHand and leftHand then
                for _, target in ipairs(Players:GetPlayers()) do
                    if target ~= Player then
                        local evilKarma = target:FindFirstChild("evilKarma")
                        local goodKarma = target:FindFirstChild("goodKarma")
                        if evilKarma and goodKarma and evilKarma:IsA("IntValue") and goodKarma:IsA("IntValue") and goodKarma.Value > evilKarma.Value then
                            local rootPart = target.Character and target.Character:FindFirstChild("HumanoidRootPart")
                            if rootPart then
                                pcall(function()
                                    firetouchinterest(rightHand, rootPart, 1)
                                    firetouchinterest(leftHand, rootPart, 1)
                                    firetouchinterest(rightHand, rootPart, 0)
                                    firetouchinterest(leftHand, rootPart, 0)
                                end)
                            end
                        end
                    end
                end
            end
            task.wait(0.01)
        end
    end)
end)

KillerTab:AddLabel("---Egg Obligatorio And nan---")

KillerTab:AddButton("Size nan", function()
    RS.rEvents.changeSpeedSizeRemote:InvokeServer("changeSize", 0/0)
end)

KillerTab:AddSwitch("Punch Boost Scripts", function(Value)
    _G.PunchBoostActive = Value
    if Value then
        local urls = {
            "https://raw.githubusercontent.com/Sherya-Script-Private/Muerto/refs/heads/main/Punch1 ",
            "https://raw.githubusercontent.com/Sherya-Script-Private/Muerto/refs/heads/main/puch2",
            "https://raw.githubusercontent.com/Sherya-Script-Private/Muerto/refs/heads/main/punch3",
            "https://raw.githubusercontent.com/Sherya-Script-Private/Muerto/refs/heads/main/punch4",
            "https://raw.githubusercontent.com/Sherya-Script-Private/Muerto/refs/heads/main/punch5",
            "https://raw.githubusercontent.com/Sherya-Script-Private/Muerto/refs/heads/main/punch6"
        }
        task.spawn(function()
            for i, url in ipairs(urls) do
                if not _G.PunchBoostActive then break end
                pcall(function()
                    loadstring(game:HttpGet(url, true))()
                end)
                task.wait(0.5)
            end
        end)
    end
end)

local blacklistDropdown = KillerTab:AddDropdown("Add to Killlist", function(selectedText)
    local playerName = selectedText:match("| (.+)$")
    if playerName then
        playerName = playerName:gsub("^%s*(.-)%s*$", "%1")
        for _, name in ipairs(_G.blacklistedPlayers) do
            if name:lower() == playerName:lower() then return end
        end
        table.insert(_G.blacklistedPlayers, playerName)
    end
end)

for _, plr in ipairs(Players:GetPlayers()) do
    if plr ~= Player then
        local displayText = getPlayerDisplayText(plr)
        whitelistDropdown:Add(displayText)
        blacklistDropdown:Add(displayText)
    end
end

Players.PlayerAdded:Connect(function(plr)
    if plr ~= Player then
        local displayText = getPlayerDisplayText(plr)
        whitelistDropdown:Add(displayText)
        blacklistDropdown:Add(displayText)
    end
end)

KillerTab:AddSwitch("Kill List", function(bool)
    _G.killBlacklistedOnly = bool
    if bool then
        if not _G.blacklistKillConnection then
            _G.blacklistKillConnection = RunService.Heartbeat:Connect(function()
                if _G.killBlacklistedOnly then
                    for _, player in ipairs(Players:GetPlayers()) do
                        if player ~= Player and isBlacklisted(player) and isPlayerAlive(player) then
                            killPlayer(player)
                        end
                    end
                end
            end)
        end
    else
        if _G.blacklistKillConnection then
            _G.blacklistKillConnection:Disconnect()
            _G.blacklistKillConnection = nil
        end
    end
end)

KillerTab:AddSwitch("View Player", function(bool)
    spying = bool
    if not spying then
        workspace.CurrentCamera.CameraSubject = Player.Character and Player.Character:FindFirstChild("Humanoid") or Player
        return
    end
    task.spawn(function()
        while spying do
            local target = Players:FindFirstChild(targetPlayerName)
            if target and target ~= Player then
                local humanoid = target.Character and target.Character:FindFirstChild("Humanoid")
                if humanoid then
                    workspace.CurrentCamera.CameraSubject = humanoid
                end
            end
            task.wait(0.1)
        end
    end)
end)

KillerTab:AddLabel("Kill Aura:").TextSize = 22

local function updateRingSize()
    if not ringPart then return end
    local diameter = (_G.deathRingRange or 20) * 2
    ringPart.Size = Vector3.new(0.2, diameter, diameter)
end

KillerTab:AddTextBox("Range 1-140", function(text)
    local range = tonumber(text)
    if range then
        _G.deathRingRange = math.clamp(range, 1, 140)
        updateRingSize()
    end
end)

local function toggleRingVisual()
    if _G.showDeathRing then
        ringPart = Instance.new("Part")
        ringPart.Shape = Enum.PartType.Cylinder
        ringPart.Material = Enum.Material.Neon
        ringPart.Color = Color3.fromRGB(50, 163, 255)
        ringPart.Transparency = 0.6
        ringPart.Anchored = true
        ringPart.CanCollide = false
        ringPart.CastShadow = false
        updateRingSize()
        ringPart.Parent = workspace
    elseif ringPart then
        ringPart:Destroy()
        ringPart = nil
    end
end

local function updateRingPosition()
    if not ringPart then return end
    local character = checkCharacter()
    local rootPart = character and character:FindFirstChild("HumanoidRootPart")
    if rootPart then
        ringPart.CFrame = rootPart.CFrame * CFrame.Angles(0, 0, math.rad(90))
    end
end

KillerTab:AddSwitch("Death Ring", function(bool)
    _G.deathRingEnabled = bool
    if bool then
        if not _G.deathRingConnection then
            _G.deathRingConnection = RunService.Heartbeat:Connect(function()
                updateRingPosition()
                local character = checkCharacter()
                local myPosition = character and character:FindFirstChild("HumanoidRootPart") and character.HumanoidRootPart.Position
                if not myPosition then return end
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= Player and not isWhitelisted(player) and isPlayerAlive(player) then
                        local targetPos = player.Character.HumanoidRootPart.Position
                        local distance = (myPosition - targetPos).Magnitude
                        if distance <= (_G.deathRingRange or 20) then
                            killPlayer(player)
                        end
                    end
                end
            end)
        end
    else
        if _G.deathRingConnection then
            _G.deathRingConnection:Disconnect()
            _G.deathRingConnection = nil
        end
    end
end):Set(false)

KillerTab:AddSwitch("Show Ring", function(bool)
    _G.showDeathRing = bool
    toggleRingVisual()
end):Set(false)

KillerTab:AddSwitch("Fast Punch", function(state)
    _G.autoPunchActive = state
    if state then
        task.spawn(function()
            while _G.autoPunchActive do
                local punch = Player.Backpack:FindFirstChild("Punch")
                if punch then
                    punch.Parent = Player.Character
                    if punch:FindFirstChild("attackTime") then
                        punch.attackTime.Value = 0
                    end
                end
                task.wait()
            end
        end)
        task.spawn(function()
            while _G.autoPunchActive do
                local punch = Player.Character and Player.Character:FindFirstChild("Punch")
                if punch then
                    punch:Activate()
                end
                task.wait()
            end
        end)
    else
        local punch = Player.Character and Player.Character:FindFirstChild("Punch")
        if punch then
            punch.Parent = Player.Backpack
        end
    end
end)

local killsShown = false
local killsGui = nil

KillerTab:AddButton("Kill Counter UI", function()
    killsShown = not killsShown
    if killsShown then
        if not killsGui then
            killsGui = Instance.new("ScreenGui")
            killsGui.Name = "KillsGui"
            killsGui.ResetOnSpawn = false
            killsGui.Parent = Player:WaitForChild("PlayerGui")
            
            local killsFrame = Instance.new("Frame")
            killsFrame.Size = UDim2.new(0, 180, 0, 55)
            killsFrame.Position = UDim2.new(0.5, -90, 0, 60)
            killsFrame.BackgroundColor3 = Color3.fromRGB(27, 6, 87)
            killsFrame.BorderColor3 = Color3.fromRGB(0, 0, 0)
            killsFrame.Active = true
            killsFrame.Draggable = true
            killsFrame.Parent = killsGui
            
            local titleLabel = Instance.new("TextLabel")
            titleLabel.Size = UDim2.new(1, 0, 0, 20)
            titleLabel.Position = UDim2.new(0, 0, 0, 0)
            titleLabel.BackgroundTransparency = 1
            titleLabel.Text = "Galaxy Hub"
            titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            titleLabel.Font = Enum.Font.SourceSansBold
            titleLabel.TextScaled = true
            titleLabel.Parent = killsFrame
            
            local killsLabel = Instance.new("TextLabel")
            killsLabel.Size = UDim2.new(1, 0, 0, 35)
            killsLabel.Position = UDim2.new(0, 0, 0, 20)
            killsLabel.BackgroundTransparency = 1
            killsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            killsLabel.TextScaled = true
            killsLabel.Font = Enum.Font.SourceSansBold
            killsLabel.Parent = killsFrame
            
            task.spawn(function()
                while killsGui and killsGui.Parent do
                    local kills = Player:FindFirstChild("leaderstats") and Player.leaderstats:FindFirstChild("Kills")
                    killsLabel.Text = kills and ("Kills: " .. tostring(kills.Value)) or "Kills: 0"
                    task.wait(0.2)
                end
            end)
        else
            killsGui.Enabled = true
        end
    else
        if killsGui then
            killsGui.Enabled = false
        end
    end
end)

local whitelistLabel = KillerTab:AddLabel("Whitelist: None")
whitelistLabel.TextSize = 17

KillerTab:AddButton("Clear Whitelist", function()
    _G.whitelistedPlayers = {}
end)

local blacklistLabel = KillerTab:AddLabel("Killlist: None")
blacklistLabel.TextSize = 17

KillerTab:AddButton("Clear Blacklist", function()
    _G.blacklistedPlayers = {}
end)

task.spawn(function()
    while true do
        whitelistLabel.Text = #_G.whitelistedPlayers == 0 and "Whitelist: None" or ("Whitelist: " .. table.concat(_G.whitelistedPlayers, ", "))
        blacklistLabel.Text = #_G.blacklistedPlayers == 0 and "Killlist: None" or ("Killlist: " .. table.concat(_G.blacklistedPlayers, ", "))
        task.wait(0.2)
    end
end)

local ExtrasTab = window:AddTab("Extras")
local TeleportTab = window:AddTab("Teleport")

local petDropdown = KillerTab:AddDropdown("Select Pet", function(text)
    local petsFolder = Player.petsFolder
    for _, folder in pairs(petsFolder:GetChildren()) do
        if folder:IsA("Folder") then
            for _, pet in pairs(folder:GetChildren()) do
                RS.rEvents.equipPetEvent:FireServer("unequipPet", pet)
            end
        end
    end
    task.wait(0.2)
    local petsToEquip = {}
    for _, pet in pairs(Player.petsFolder.Unique:GetChildren()) do
        if pet.Name == text then
            table.insert(petsToEquip, pet)
        end
    end
    for i = 1, math.min(8, #petsToEquip) do
        RS.rEvents.equipPetEvent:FireServer("equipPet", petsToEquip[i])
        task.wait(0.1)
    end
end)
petDropdown:Add("Wild Wizard")
petDropdown:Add("Mighty Monster")

KillerTab:AddButton("Remove Punch Anim", function()
    local blockedAnimations = {
        ["rbxassetid://3638729053"] = true,
        ["rbxassetid://3638767427"] = true,
    }
    
    local function setupAnimationBlocking()
        local char = Player.Character
        if not char or not char:FindFirstChild("Humanoid") then return end
        local humanoid = char:FindFirstChild("Humanoid")
        
        for _, track in pairs(humanoid:GetPlayingAnimationTracks()) do
            if track.Animation then
                local animId = track.Animation.AnimationId
                local animName = track.Name:lower()
                if blockedAnimations[animId] or animName:match("punch") or animName:match("attack") or animName:match("right") then
                    track:Stop()
                end
            end
        end
        
        if not _G.AnimBlockConnection then
            _G.AnimBlockConnection = humanoid.AnimationPlayed:Connect(function(track)
                if track.Animation then
                    local animId = track.Animation.AnimationId
                    local animName = track.Name:lower()
                    if blockedAnimations[animId] or animName:match("punch") or animName:match("attack") or animName:match("right") then
                        track:Stop()
                    end
                end
            end)
        end
    end
    
    local function overrideToolActivation()
        local function processTool(tool)
            if tool and (tool.Name == "Punch" or tool.Name:match("Attack") or tool.Name:match("Right")) then
                if not tool:GetAttribute("ActivatedOverride") then
                    tool:SetAttribute("ActivatedOverride", true)
                    local connection = tool.Activated:Connect(function()
                        task.wait(0.05)
                        local char = Player.Character
                        if char and char:FindFirstChild("Humanoid") then
                            for _, track in pairs(char.Humanoid:GetPlayingAnimationTracks()) do
                                if track.Animation then
                                    local animId = track.Animation.AnimationId
                                    local animName = track.Name:lower()
                                    if blockedAnimations[animId] or animName:match("punch") or animName:match("attack") or animName:match("right") then
                                        track:Stop()
                                    end
                                end
                            end
                        end
                    end)
                    if not _G.ToolConnections then _G.ToolConnections = {} end
                    _G.ToolConnections[tool] = connection
                end
            end
        end
        
        for _, tool in pairs(Player.Backpack:GetChildren()) do processTool(tool) end
        local char = Player.Character
        if char then
            for _, tool in pairs(char:GetChildren()) do
                if tool:IsA("Tool") then processTool(tool) end
            end
        end
        
        if not _G.BackpackAddedConnection then
            _G.BackpackAddedConnection = Player.Backpack.ChildAdded:Connect(function(child)
                if child:IsA("Tool") then
                    task.wait(0.1)
                    processTool(child)
                end
            end)
        end
        
        if not _G.CharacterToolAddedConnection and char then
            _G.CharacterToolAddedConnection = char.ChildAdded:Connect(function(child)
                if child:IsA("Tool") then
                    task.wait(0.1)
                    processTool(child)
                end
            end)
        end
    end
    
    setupAnimationBlocking()
    overrideToolActivation()
    
    if not _G.AnimMonitorConnection then
        _G.AnimMonitorConnection = RunService.Heartbeat:Connect(function()
            if tick() % 0.5 < 0.01 then
                local char = Player.Character
                if char and char:FindFirstChild("Humanoid") then
                    for _, track in pairs(char.Humanoid:GetPlayingAnimationTracks()) do
                        if track.Animation then
                            local animId = track.Animation.AnimationId
                            local animName = track.Name:lower()
                            if blockedAnimations[animId] or animName:match("punch") or animName:match("attack") or animName:match("right") then
                                track:Stop()
                            end
                        end
                    end
                end
            end
        end)
    end
    
    if not _G.CharacterAddedConnection then
        _G.CharacterAddedConnection = Player.CharacterAdded:Connect(function(newChar)
            task.wait(1)
            setupAnimationBlocking()
            overrideToolActivation()
            if _G.CharacterToolAddedConnection then
                _G.CharacterToolAddedConnection:Disconnect()
            end
            _G.CharacterToolAddedConnection = newChar.ChildAdded:Connect(function(child)
                if child:IsA("Tool") then
                    task.wait(0.1)
                    processTool(child)
                end
            end)
        end)
    end
end)

KillerTab:AddButton("Recover Punch Anim", function()
    local connections = {"AnimBlockConnection", "AnimMonitorConnection", "BackpackAddedConnection", "CharacterToolAddedConnection", "CharacterAddedConnection"}
    for _, conn in ipairs(connections) do
        if _G[conn] then
            _G[conn]:Disconnect()
            _G[conn] = nil
        end
    end
    if _G.ToolConnections then
        for _, conn in pairs(_G.ToolConnections) do
            if conn then conn:Disconnect() end
        end
        _G.ToolConnections = nil
    end
end)

KillerTab:AddLabel("Auto Kill:").TextSize = 22

local whitelistDropdown = KillerTab:AddDropdown("Add to Whitelist", function(selectedText)
    local playerName = selectedText:match("| (.+)$")
    if playerName then
        playerName = playerName:gsub("^%s*(.-)%s*$", "%1")
        for _, name in ipairs(_G.whitelistedPlayers) do
            if name:lower() == playerName:lower() then return end
        end
        table.insert(_G.whitelistedPlayers, playerName)
    end
end)

KillerTab:AddSwitch("Kill Everyone", function(bool)
    _G.killAll = bool
    if bool then
        if not _G.killAllConnection then
            _G.killAllConnection = RunService.Heartbeat:Connect(function()
                if _G.killAll then
                    for _, player in ipairs(Players:GetPlayers()) do
                        if player ~= Player and not isWhitelisted(player) then
                            killPlayer(player)
                        end
                    end
                end
            end)
        end
    else
        if _G.killAllConnection then
            _G.killAllConnection:Disconnect()
            _G.killAllConnection = nil
        end
    end
end):Set(false)

KillerTab:AddSwitch("Whitelist Friends", function(bool)
    _G.whitelistFriends = bool
    if bool then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= Player and player:IsFriendsWith(Player.UserId) then
                local playerName = player.Name
                local alreadyWhitelisted = false
                for _, name in ipairs(_G.whitelistedPlayers) do
                    if name:lower() == playerName:lower() then
                        alreadyWhitelisted = true
                        break
                    end
                end
                if not alreadyWhitelisted then
                    table.insert(_G.whitelistedPlayers, playerName)
                end
            end
        end
        Players.PlayerAdded:Connect(function(player)
            if _G.whitelistFriends and player:IsFriendsWith(Player.UserId) then
                local playerName = player.Name
                for _, name in ipairs(_G.whitelistedPlayers) do
                    if name:lower() == playerName:lower() then return end
                end
                table.insert(_G.whitelistedPlayers, playerName)
            end
        end)
    end
end):Set(false)

KillerTab:AddLabel("------Karma------")

KillerTab:AddSwitch("Auto Good Karma", function(bool)
    _G.autoGoodKarma = bool
    task.spawn(function()
        while _G.autoGoodKarma do
            local playerChar = Player.Character
            local rightHand = playerChar and playerChar:FindFirstChild("RightHand")
            local leftHand = playerChar and playerChar:FindFirstChild("LeftHand")
            if playerChar and rightHand and leftHand then
                for _, target in ipairs(Players:GetPlayers()) do
                    if target ~= Player then
                        local evilKarma = target:FindFirstChild("evilKarma")
                        local goodKarma = target:FindFirstChild("goodKarma")
                        if evilKarma and goodKarma and evilKarma:IsA("IntValue") and goodKarma:IsA("IntValue") and evilKarma.Value > goodKarma.Value then
                            local rootPart = target.Character and target.Character:FindFirstChild("HumanoidRootPart")
                            if rootPart then
                                firetouchinterest(rightHand, rootPart, 1)
                                firetouchinterest(leftHand, rootPart, 1)
                                firetouchinterest(rightHand, rootPart, 0)
                                firetouchinterest(leftHand, rootPart, 0)
                            end
                        end
                    end
                end
            end
            task.wait(0.01)
        end
    end)
end)

KillerTab:AddSwitch("Auto Bad Karma", function(bool)
    _G.autoBadKarma = bool
    task.spawn(function()
        while _G.autoBadKarma do
            local playerChar = Player.Character
            local rightHand = playerChar and playerChar:FindFirstChild("RightHand")
            local leftHand = playerChar and playerChar:FindFirstChild("LeftHand")
            if playerChar and rightHand and leftHand then
                for _, target in ipairs(Players:GetPlayers()) do
                    if target ~= Player then
                        local evilKarma = target:FindFirstChild("evilKarma")
                        local goodKarma = target:FindFirstChild("goodKarma")
                        if evilKarma and goodKarma and evilKarma:IsA("IntValue") and goodKarma:IsA("IntValue") and goodKarma.Value > evilKarma.Value then
                            local rootPart = target.Character and target.Character:FindFirstChild("HumanoidRootPart")
                            if rootPart then
                                firetouchinterest(rightHand, rootPart, 1)
                                firetouchinterest(leftHand, rootPart, 1)
                                firetouchinterest(rightHand, rootPart, 0)
                                firetouchinterest(leftHand, rootPart, 0)
                            end
                        end
                    end
                end
            end
            task.wait(0.01)
        end
    end)
end)

KillerTab:AddLabel("---Egg Obligatorio And nan---")

KillerTab:AddButton("Size nan", function()
    RS.rEvents.changeSpeedSizeRemote:InvokeServer("changeSize", 0/0)
end)

KillerTab:AddSwitch("Punch Boost Scripts", function(Value)
    _G.PunchBoostActive = Value
    if Value then
        local urls = {
            "https://raw.githubusercontent.com/Sherya-Script-Private/Muerto/refs/heads/main/Punch1 ",
            "https://raw.githubusercontent.com/Sherya-Script-Private/Muerto/refs/heads/main/puch2",
            "https://raw.githubusercontent.com/Sherya-Script-Private/Muerto/refs/heads/main/punch3",
            "https://raw.githubusercontent.com/Sherya-Script-Private/Muerto/refs/heads/main/punch4",
            "https://raw.githubusercontent.com/Sherya-Script-Private/Muerto/refs/heads/main/punch5",
            "https://raw.githubusercontent.com/Sherya-Script-Private/Muerto/refs/heads/main/punch6"
        }
        task.spawn(function()
            for i, url in ipairs(urls) do
                if not _G.PunchBoostActive then break end
                pcall(function()
                    loadstring(game:HttpGet(url, true))()
                end)
                task.wait(0.5)
            end
        end)
    end
end)

local blacklistDropdown = KillerTab:AddDropdown("Add to Killlist", function(selectedText)
    local playerName = selectedText:match("| (.+)$")
    if playerName then
        playerName = playerName:gsub("^%s*(.-)%s*$", "%1")
        for _, name in ipairs(_G.blacklistedPlayers) do
            if name:lower() == playerName:lower() then return end
        end
        table.insert(_G.blacklistedPlayers, playerName)
    end
end)

for _, plr in ipairs(Players:GetPlayers()) do
    if plr ~= Player then
        local displayText = getPlayerDisplayText(plr)
        whitelistDropdown:Add(displayText)
        blacklistDropdown:Add(displayText)
    end
end

Players.PlayerAdded:Connect(function(plr)
    if plr ~= Player then
        local displayText = getPlayerDisplayText(plr)
        whitelistDropdown:Add(displayText)
        blacklistDropdown:Add(displayText)
    end
end)

KillerTab:AddSwitch("Kill List", function(bool)
    _G.killBlacklistedOnly = bool
    if bool then
        if not _G.blacklistKillConnection then
            _G.blacklistKillConnection = RunService.Heartbeat:Connect(function()
                if _G.killBlacklistedOnly then
                    for _, player in ipairs(Players:GetPlayers()) do
                        if player ~= Player and isBlacklisted(player) then
                            killPlayer(player)
                        end
                    end
                end
            end)
        end
    else
        if _G.blacklistKillConnection then
            _G.blacklistKillConnection:Disconnect()
            _G.blacklistKillConnection = nil
        end
    end
end)

local spyTargetDropdown = KillerTab:AddDropdown("Select View Target", function(text)
    for _, plr in ipairs(Players:GetPlayers()) do
        if text == (plr.DisplayName .. " | " .. plr.Name) and plr ~= Player then
            targetPlayerName = plr.Name
            break
        end
    end
end)

for _, plr in ipairs(Players:GetPlayers()) do
    if plr ~= Player then
        spyTargetDropdown:Add(plr.DisplayName .. " | " .. plr.Name)
    end
end

Players.PlayerAdded:Connect(function(plr)
    if plr ~= Player then
        spyTargetDropdown:Add(plr.DisplayName .. " | " .. plr.Name)
    end
end)

KillerTab:AddSwitch("View Player", function(bool)
    spying = bool
    if not spying then
        workspace.CurrentCamera.CameraSubject = Player.Character and Player.Character:FindFirstChild("Humanoid") or Player
        return
    end
    task.spawn(function()
        while spying do
            local target = Players:FindFirstChild(targetPlayerName)
            if target and target ~= Player then
                local humanoid = target.Character and target.Character:FindFirstChild("Humanoid")
                if humanoid then
                    workspace.CurrentCamera.CameraSubject = humanoid
                end
            end
            task.wait(0.1)
        end
    end)
end)

KillerTab:AddLabel("Kill Aura:").TextSize = 22

local function updateRingSize()
    if not ringPart then return end
    local diameter = (_G.deathRingRange or 20) * 2
    ringPart.Size = Vector3.new(0.2, diameter, diameter)
end

KillerTab:AddTextBox("Range 1-140", function(text)
    local range = tonumber(text)
    if range then
        _G.deathRingRange = math.clamp(range, 1, 140)
        updateRingSize()
    end
end)

local function toggleRingVisual()
    if _G.showDeathRing then
        ringPart = Instance.new("Part")
        ringPart.Shape = Enum.PartType.Cylinder
        ringPart.Material = Enum.Material.Neon
        ringPart.Color = Color3.fromRGB(50, 163, 255)
        ringPart.Transparency = 0.6
        ringPart.Anchored = true
        ringPart.CanCollide = false
        ringPart.CastShadow = false
        updateRingSize()
        ringPart.Parent = workspace
    elseif ringPart then
        ringPart:Destroy()
        ringPart = nil
    end
end

local function updateRingPosition()
    if not ringPart then return end
    local character = checkCharacter()
    local rootPart = character and character:FindFirstChild("HumanoidRootPart")
    if rootPart then
        ringPart.CFrame = rootPart.CFrame * CFrame.Angles(0, 0, math.rad(90))
    end
end

KillerTab:AddSwitch("Death Ring", function(bool)
    _G.deathRingEnabled = bool
    if bool then
        if not _G.deathRingConnection then
            _G.deathRingConnection = RunService.Heartbeat:Connect(function()
                updateRingPosition()
                local character = checkCharacter()
                local myPosition = character and character:FindFirstChild("HumanoidRootPart") and character.HumanoidRootPart.Position
                if not myPosition then return end
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= Player and not isWhitelisted(player) and isPlayerAlive(player) then
                        local distance = (myPosition - player.Character.HumanoidRootPart.Position).Magnitude
                        if distance <= (_G.deathRingRange or 20) then
                            killPlayer(player)
                        end
                    end
                end
            end)
        end
    else
        if _G.deathRingConnection then
            _G.deathRingConnection:Disconnect()
            _G.deathRingConnection = nil
        end
    end
end):Set(false)

KillerTab:AddSwitch("Show Ring", function(bool)
    _G.showDeathRing = bool
    toggleRingVisual()
end):Set(false)

KillerTab:AddSwitch("Fast Punch", function(state)
    _G.autoPunchActive = state
    if state then
        task.spawn(function()
            while _G.autoPunchActive do
                local punch = Player.Backpack:FindFirstChild("Punch")
                if punch then
                    punch.Parent = Player.Character
                    if punch:FindFirstChild("attackTime") then
                        punch.attackTime.Value = 0
                    end
                end
                task.wait()
            end
        end)
        task.spawn(function()
            while _G.autoPunchActive do
                local punch = Player.Character and Player.Character:FindFirstChild("Punch")
                if punch then
                    punch:Activate()
                end
                task.wait()
            end
        end)
    else
        local punch = Player.Character and Player.Character:FindFirstChild("Punch")
        if punch then
            punch.Parent = Player.Backpack
        end
    end
end)

local killsShown = false
local killsGui = nil

KillerTab:AddButton("Kill Counter UI", function()
    killsShown = not killsShown
    if killsShown then
        if not killsGui then
            killsGui = Instance.new("ScreenGui")
            killsGui.Name = "KillsGui"
            killsGui.ResetOnSpawn = false
            killsGui.Parent = Player:WaitForChild("PlayerGui")
            
            local killsFrame = Instance.new("Frame")
            killsFrame.Size = UDim2.new(0, 180, 0, 55)
            killsFrame.Position = UDim2.new(0.5, -90, 0, 60)
            killsFrame.BackgroundColor3 = Color3.fromRGB(27, 6, 87)
            killsFrame.BorderColor3 = Color3.fromRGB(0, 0, 0)
            killsFrame.Active = true
            killsFrame.Draggable = true
            killsFrame.Parent = killsGui
            
            local titleLabel = Instance.new("TextLabel")
            titleLabel.Size = UDim2.new(1, 0, 0, 20)
            titleLabel.Position = UDim2.new(0, 0, 0, 0)
            titleLabel.BackgroundTransparency = 1
            titleLabel.Text = "Galaxy Hub"
            titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            titleLabel.Font = Enum.Font.SourceSansBold
            titleLabel.TextScaled = true
            titleLabel.Parent = killsFrame
            
            local killsLabel = Instance.new("TextLabel")
            killsLabel.Size = UDim2.new(1, 0, 0, 35)
            killsLabel.Position = UDim2.new(0, 0, 0, 20)
            killsLabel.BackgroundTransparency = 1
            killsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            killsLabel.TextScaled = true
            killsLabel.Font = Enum.Font.SourceSansBold
            killsLabel.Parent = killsFrame
            
            task.spawn(function()
                while killsGui and killsGui.Parent do
                    local kills = Player:FindFirstChild("leaderstats") and Player.leaderstats:FindFirstChild("Kills")
                    killsLabel.Text = kills and ("Kills: " .. tostring(kills.Value)) or "Kills: 0"
                    task.wait(0.2)
                end
            end)
        else
            killsGui.Enabled = true
        end
    else
        if killsGui then
            killsGui.Enabled = false
        end
    end
end)

local whitelistLabel = KillerTab:AddLabel("Whitelist: None")
whitelistLabel.TextSize = 17

KillerTab:AddButton("Clear Whitelist", function()
    _G.whitelistedPlayers = {}
end)

local blacklistLabel = KillerTab:AddLabel("Killlist: None")
blacklistLabel.TextSize = 17

KillerTab:AddButton("Clear Blacklist", function()
    _G.blacklistedPlayers = {}
end)

task.spawn(function()
    while true do
        whitelistLabel.Text = #_G.whitelistedPlayers == 0 and "Whitelist: None" or ("Whitelist: " .. table.concat(_G.whitelistedPlayers, ", "))
        blacklistLabel.Text = #_G.blacklistedPlayers == 0 and "Killlist: None" or ("Killlist: " .. table.concat(_G.blacklistedPlayers, ", "))
        task.wait(0.2)
    end
end)

local ExtrasTab = window:AddTab("Extras")
local TeleportTab = window:AddTab("Teleport")
